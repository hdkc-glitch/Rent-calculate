<html lang="en" class="" style="--rgb-primary-color: 0,123,255;"><head>

  <meta charset="UTF-8">
  <title>CodePen Demo</title>

  <meta name="robots" content="noindex">

  <link rel="shortcut icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico">
  <link rel="mask-icon" href="https://cpwebassets.codepen.io/assets/favicon/logo-pin-b4b4269c16397ad2f0f7a01bcdf513a1994f4c94b8af2f191c09eb0d601762b1.svg" color="#111">
  <link rel="canonical" href="https://codepen.io/pen">

  
  

  <style id="INLINE_PEN_STYLESHEET_ID">
    
  </style>

  
</head>

<body>
  html
--- START OF FILE a,1.html ---



  <meta charset="UTF-8">
  <title>CodePen Demo</title>

  <meta name="robots" content="noindex">

  <link rel="shortcut icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico">
  <link rel="mask-icon" href="https://cpwebassets.codepen.io/assets/favicon/logo-pin-b4b4269c16397ad2f0f7a01bcdf513a1994f4c94b8af2f191c09eb0d601762b1.svg" color="#111">
  <link rel="canonical" href="https://codepen.io/pen">

  
  

  <style id="INLINE_PEN_STYLESHEET_ID">
    
  </style>

  
<script src="https://cpwebassets.codepen.io/assets/common/stopExecutionOnTimeout-2c7831bb44f98c1391d6a4ffda0e1fd302503391ca806e7fcc7b9b87197aec26.js"></script>
<script src="https://cpwebassets.codepen.io/assets/editor/iframe/iframeConsoleRunner-6d8bf8b4b479137260842506acbb12717dace0823c023e08b96360e60b0840d9.js"></script>
<script src="https://cpwebassets.codepen.io/assets/editor/iframe/iframeRefreshCSS-44fe83e49b63affec96918c9af88c0d80b209a862cf87ac46bc933074b8c557d.js"></script>
<script src="https://cpwebassets.codepen.io/assets/editor/iframe/iframeRuntimeErrors-4f205f2c14e769b448bcf477de2938c681660d5038bc464e3700256713ebe261.js"></script>



  html



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶¨‡¶æ‡ßú‡¶ø ‡¶≠‡¶æ‡ßú‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü (‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶°-‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶∏‡¶π)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        /* CSS ‡¶ï‡ßã‡¶° ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ‡¶•‡¶æ‡¶ï‡¶¨‡ßá, ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá */
        /* ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ CSS ‡¶ï‡ßã‡¶° ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® */
        /* ... (‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ CSS ‡¶ï‡ßã‡¶° ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶¨‡ßá) ... */

        /* --- Global Variables & Base Styles --- */
        :root {
            --primary-color: #007bff; /* Vibrant Blue */
            --primary-color-dark: #0056b3; /* Darker Blue */
            --primary-color-light: #66b3ff; /* Lighter Blue for gradients/hovers */
            --secondary-color: #6c757d; /* Cool Grey */
            --secondary-color-dark: #545b62; /* Darker Grey */
            --success-color: #28a745; /* Rich Green */
            --success-color-dark: #1e7e34; /* Darker Green */
            --danger-color: #dc3545; /* Strong Red */
            --danger-color-dark: #c82333; /* Darker Red */
            --warning-color: #ffc107; /* Bright Yellow/Orange */
            --warning-color-dark: #e0a800; /* Darker Yellow/Orange */
            --info-color: #17a2b8; /* Teal Blue */
            --info-color-dark: #117a8b; /* Darker Teal */
            --light-color: #f8f9fa;
            --dark-color: #212529; /* Near Black for text */
            --text-color: #343a40; /* Main text color */
            --text-color-light: #6c757d; /* Lighter text for secondary info */
            --border-color: #ced4da; /* Subtle border */
            --card-bg: #ffffff;
            --body-bg-gradient-start: #f4f6f9; /* Light, almost white */
            --body-bg-gradient-end: #e9ecef;   /* Slightly darker light grey */
            
            --font-family: 'Noto Sans Bengali', 'Arial', sans-serif;
            
            --box-shadow-soft: 0 4px 12px rgba(0, 0, 0, 0.08);
            --box-shadow-medium: 0 8px 20px rgba(0, 0, 0, 0.1);
            --box-shadow-strong: 0 12px 28px rgba(0, 0, 0, 0.15);
            --box-shadow-inset: inset 0 2px 4px rgba(0,0,0,0.06);

            --border-radius-lg: 16px;
            --border-radius-md: 10px;
            --border-radius-sm: 6px;

            --premium-gradient-start: #667eea; /* Indigo */
            --premium-gradient-end: #764ba2;   /* Purple */

            --input-bg: #fdfdfd;
            --input-focus-bg: #ffffff;
            --input-focus-border: var(--primary-color);
            --input-shadow: 0 1px 3px rgba(0,0,0,0.05);
            --rgb-primary-color: 0,123,255; /* Default, will be updated by JS */
        }

        /* --- Icons --- */
        [class^="icon-"], [class*=" icon-"] { display: inline-block; margin-right: 8px; font-family: 'Arial'; vertical-align: middle; }
        .icon-login::before { content: "üîë"; } .icon-register::before { content: "üìù"; }
        .icon-submit::before { content: "‚úîÔ∏è"; } .icon-back::before { content: "‚Ü©Ô∏è"; }
        .icon-cancel::before { content: "‚ùå"; } .icon-add::before { content: "‚ûï"; }
        .icon-confirm::before { content: "üëç"; } .icon-admin::before { content: "üëë"; }
        .icon-logout::before { content: "üö™"; } .icon-users::before { content: "üë•"; }
        .icon-delete::before { content: "üóëÔ∏è"; } .icon-edit::before { content: "‚úèÔ∏è"; }
        .icon-save::before { content: "üíæ"; } .icon-info::before { content: "‚ÑπÔ∏è"; }
        .icon-user::before { content: "üë§"; } .icon-mobile::before { content: "üì±"; }
        .icon-meter::before { content: "üí°"; } .icon-id::before { content: "üÜî"; }
        .icon-advance-taka::before { content: "üí∞"; } .icon-nid::before { content: "üí≥"; }
        .icon-defaults::before { content: "‚öôÔ∏è"; } .icon-rent::before { content: "üè†"; }
        .icon-gas::before { content: "üî•"; } .icon-billing::before { content: "üßæ"; }
        .icon-add-bill::before { content: "‚ûï"; } .icon-save-file::before { content: "üìÑ"; }
        .icon-view::before { content: "üëÅÔ∏è‚Äçüó®Ô∏è"; } .icon-hide::before { content: "üôà"; }
        .icon-draft::before { content: "‚úçÔ∏è"; } .icon-cloud-save::before { content: "‚òÅÔ∏è"; }
        .icon-cloud-connect::before { content: "üîó"; } .icon-profile::before { content: "üßë"; }

        /* --- Base & Body --- */
        *, *::before, *::after { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { 
            font-family: var(--font-family); 
            line-height: 1.7; 
            margin: 0; 
            padding: 20px; 
            background-color: var(--body-bg-gradient-start);
            background-image: linear-gradient(145deg, var(--body-bg-gradient-start) 0%, var(--body-bg-gradient-end) 100%);
            color: var(--text-color); 
            font-size: 16px; 
            -webkit-font-smoothing: antialiased; 
            -moz-osx-font-smoothing: grayscale; 
            min-height: 100vh;
        }

        .container { max-width: 980px; margin: 20px auto; padding: 0 15px; }

        header { 
            text-align: center; 
            margin-bottom: 40px; 
            padding-bottom: 20px; 
            border-bottom: 3px solid;
            border-image-slice: 1;
            border-image-source: linear-gradient(to right, var(--primary-color-light), var(--primary-color-dark));
        }
        header h1 { 
            color: var(--dark-color); 
            font-weight: 700; 
            font-size: 2.6em; 
            letter-spacing: 0.5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        header .header-edition {
            font-size: 0.5em;
            color: var(--text-color-light);
            font-weight: 500;
            display: block;
            margin-top: 5px;
            letter-spacing: 1px;
        }

        h2, h3.modal-title { 
            color: var(--primary-color-dark); 
            margin-top: 0; 
            padding-bottom: 15px; 
            border-bottom: 2px solid var(--primary-color-light); 
            font-size: 1.9em; 
            font-weight: 600; 
            margin-bottom: 30px;
        }
        h3.modal-title { font-size: 1.7em; margin-bottom: 25px; border-bottom-width: 1px; }
        h3.sub-heading {
            font-size: 1.4em;
            color: var(--primary-color);
            margin-top: 35px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--border-color);
        }

        .card { 
            background-color: var(--card-bg); 
            padding: 30px 35px; 
            border-radius: var(--border-radius-lg); 
            box-shadow: var(--box-shadow-medium); 
            margin-bottom: 40px; 
            border: 1px solid #e0e0e0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-6px) scale(1.01);
            box-shadow: var(--box-shadow-strong);
        }

        .form-group { margin-bottom: 25px; }
        .form-group label { 
            display: flex; 
            align-items: center;
            margin-bottom: 10px; 
            font-weight: 500; 
            color: var(--text-color);
            font-size: 1em; 
        }
        .form-group label i { color: var(--primary-color); font-size: 1.1em; }

        input[type="text"], 
        input[type="number"], 
        input[type="password"], 
        input[type="email"],
        textarea, 
        select { 
            width: 100%; 
            padding: 15px 20px; 
            border: 1px solid var(--border-color); 
            border-radius: var(--border-radius-md); 
            box-sizing: border-box; 
            font-size: 1em; 
            font-family: var(--font-family); 
            transition: border-color 0.25s ease, box-shadow 0.25s ease, background-color 0.25s ease; 
            background-color: var(--input-bg);
            box-shadow: var(--input-shadow);
        }
        input:read-only, textarea:read-only { 
            background-color: #f0f3f5 !important; 
            cursor: not-allowed; 
            color: var(--text-color-light); 
            border-color: #dde2e7;
            box-shadow: none;
        } 
        .confirmed-input { 
            background-color: #fff8e1 !important; 
            border-color: #ffe082 !important; 
            color: #5d4037; 
        }
        input[type="text"]:focus, 
        input[type="number"]:focus, 
        input[type="password"]:focus, 
        input[type="email"]:focus,
        textarea:focus, 
        select:focus { 
            border-color: var(--input-focus-border); 
            box-shadow: 0 0 0 0.25rem rgba(var(--rgb-primary-color),0.25);
            outline: none; 
            background-color: var(--input-focus-bg);
        }

        input.readonly-input { background-color: #e9ecef; cursor: not-allowed; }
        textarea.auto-expand, input.auto-expand, select.auto-expand { 
            overflow-y: hidden; 
            resize: none; 
            min-height: 56px; 
        }

        .btn { 
            padding: 12px 28px; 
            border: none; 
            border-radius: var(--border-radius-md); 
            cursor: pointer; 
            font-size: 1.05em; 
            font-weight: 600; 
            font-family: var(--font-family); 
            transition: all 0.25s ease-out; 
            text-decoration: none; 
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px; 
            margin-bottom: 12px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.08);
            line-height: 1.5;
            letter-spacing: 0.5px;
            text-transform: capitalize;
        }
        .btn:hover { 
            transform: translateY(-3px) scale(1.03); 
            box-shadow: 0 5px 12px rgba(0,0,0,0.15), 0 3px 6px rgba(0,0,0,0.1); 
        } 
        .btn:active { 
            transform: translateY(-1px) scale(0.99); 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .btn-small { padding: 9px 18px; font-size: 0.9em; font-weight: 500; }
        
        .btn-primary { background-image: linear-gradient(to top right, var(--primary-color-light), var(--primary-color)); color: white; border: 1px solid var(--primary-color-dark); } 
        .btn-primary:hover { background-image: linear-gradient(to top right, var(--primary-color), var(--primary-color-dark)); }
        
        .btn-success { background-image: linear-gradient(to top right, #34d058, var(--success-color)); color: white; border: 1px solid var(--success-color-dark); } 
        .btn-success:hover { background-image: linear-gradient(to top right, var(--success-color), var(--success-color-dark)); }
        
        .btn-danger { background-image: linear-gradient(to top right, #ff6b6b, var(--danger-color)); color: white; border: 1px solid var(--danger-color-dark); } 
        .btn-danger:hover { background-image: linear-gradient(to top right, var(--danger-color), var(--danger-color-dark)); }

        .btn-secondary { background-color: var(--secondary-color); color: white; border: 1px solid var(--secondary-color-dark);} 
        .btn-secondary:hover { background-color: var(--secondary-color-dark); }
        
        .btn-info { background-color: var(--info-color); color: white; border: 1px solid var(--info-color-dark); } 
        .btn-info:hover { background-color: var(--info-color-dark); } 
        
        .btn-warning { background-color: var(--warning-color); color: var(--dark-color); border: 1px solid var(--warning-color-dark); } 
        .btn-warning:hover { background-color: var(--warning-color-dark); }

        .btn-light { background-color: var(--light-color); color: var(--dark-color); border: 1px solid #ccc;}
        .btn-light:hover { background-color: #e2e6ea; }

        .note { 
            font-size: 0.95em; 
            color: var(--text-color-light); 
            margin-top: 20px; 
            background-color: #eef2f5; 
            padding: 18px 20px; 
            border-left: 5px solid var(--info-color); 
            border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0; 
            box-shadow: var(--box-shadow-soft);
        }
        .error-message { 
            color: var(--danger-color-dark); 
            font-size: 0.92em; 
            margin-top: 15px; 
            text-align: left; 
            font-weight: 500; 
            padding: 12px 15px;
            background-color: #fdecea; 
            border: 1px solid var(--danger-color);
            border-radius: var(--border-radius-md);
            display: block;
        }

        .tenant-info-premium {
            background-image: linear-gradient(135deg, var(--premium-gradient-start) 0%, var(--premium-gradient-end) 100%);
            border: none;
            color: white;
            padding: 40px;
        }
        .tenant-info-premium h2, .tenant-info-premium h3.sub-heading {
            color: white;
            border-bottom-color: rgba(255,255,255,0.3);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        .tenant-info-premium .form-group label { color: rgba(255,255,255,0.9); }
        .tenant-info-premium .form-group label i { color: rgba(255,255,255,0.8); }
        .tenant-info-premium input, .tenant-info-premium select {
            background-color: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            box-shadow: var(--box-shadow-inset), 0 1px 2px rgba(0,0,0,0.1);
        }
        .tenant-info-premium input::placeholder { color: rgba(255,255,255,0.6); }
        .tenant-info-premium input:focus, .tenant-info-premium select:focus {
            background-color: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.7);
            box-shadow: 0 0 0 0.2rem rgba(255,255,255,0.25);
        }
        .tenant-info-premium input.readonly-input {
             background-color: rgba(0,0,0,0.1) !important;
             color: rgba(255,255,255,0.7) !important;
             border-color: rgba(255,255,255,0.2) !important;
        }

        .tenant-details-grid, .default-values-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 28px; 
        }
        .default-values-grid { margin-top: 35px; }

        #billing-records-container { 
            margin-top: 35px; 
            display: flex; 
            flex-direction: column; 
            gap: 35px; 
        }
        .billing-record-card { 
            border-radius: var(--border-radius-lg); 
            padding: 28px; 
            box-shadow: var(--box-shadow-soft); 
            border-left: 6px solid var(--primary-color-light);
        }
        .billing-record-card:hover { 
            box-shadow: var(--box-shadow-medium); 
            border-left-color: var(--primary-color);
        }
        .billing-record-card.confirmed { 
            border-left: 6px solid var(--warning-color); 
            background-color: #fffaf0; 
        }
        .billing-record-card.confirmed .card-header { 
            background-color: #fff3cd; 
            padding: 18px 22px; 
            margin: -28px -28px 22px -28px; 
            border-bottom: 1px solid var(--warning-color); 
            border-top-left-radius: var(--border-radius-lg); 
            border-top-right-radius: var(--border-radius-lg);
        }
        .billing-record-card.confirmed .card-header h4 { color: var(--warning-color-dark); }

        .billing-record-card .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 28px; 
            padding-bottom: 20px; 
            border-bottom: 1px solid var(--border-color); 
        }
        .billing-record-card .card-header h4 { 
            margin: 0; 
            font-size: 1.45em; 
            color: var(--primary-color-dark); 
            font-weight: 600;
        }
        .billing-record-card .card-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .billing-record-card .card-content.hidden { display: none; }
        .billing-record-card .form-group { margin-bottom: 20px; }
        .billing-record-card .form-group label { font-size: 0.9em; margin-bottom: 6px; color: #555; font-weight: 500;}
        
        .billing-record-card input[type="number"], 
        .billing-record-card input[type="text"], 
        .billing-record-card textarea { 
            padding: 12px 16px; 
            font-size: 0.98em; 
            min-height: 48px; 
        }
        .billing-record-card textarea { min-height: 80px; }
        .billing-record-card .readonly-calc-field { 
            background-color: #e9f5ff !important; 
            font-weight: 600; 
            color: var(--primary-color-dark); 
            border: 1px dashed var(--primary-color-light);
            text-align: right;
        }

        .input-with-meta { display: flex; align-items: center; gap: 12px; }
        .input-with-meta input { flex-grow: 1; }
        .input-meta-info { font-size: 0.88em; color: var(--text-color-light); white-space: nowrap; padding-left: 5px; }

        .depositF-group.has-deposit { 
            background-color: #e0f7fa; 
            padding: 15px; 
            border-radius: var(--border-radius-md); 
            margin: -5px -15px 15px -15px;
            border: 1px solid #b2ebf2;
        } 
        .currentC-paid-amount-group { 
            padding: 15px; 
            border-radius: var(--border-radius-md); 
            transition: background-color 0.3s ease, border-color 0.3s ease;
            border: 1px solid transparent;
            margin: -5px -15px 15px -15px;
        }
        .currentC-paid-amount-group.not-paid { background-color: #ffebee; border-color: #ffcdd2;} 
        .currentC-paid-amount-group.paid { background-color: #e8f5e9; border-color: #c8e6c9;} 
        
        .totalAmountT-field.readonly-calc-field {
            transition: background-color 0.6s ease-in-out, border-color 0.6s ease-in-out; 
            font-weight: 700 !important;
            font-size: 1.1em !important;
            color: var(--primary-color-dark) !important;
        } 

        .status-display { 
            font-weight: 600; 
            text-align: center; 
            padding: 14px 18px; 
            border-radius: var(--border-radius-md); 
            margin-top: 25px; 
            font-size: 1.15em; 
            border: 1px solid transparent;
            box-shadow: var(--box-shadow-soft);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .status-paid { background-image: linear-gradient(to right, #d4edda, #c8e6c9); color: #155724; border-color: #b8dfba;} 
        .status-due { background-image: linear-gradient(to right, #f8d7da, #f5c6cb); color: #721c24; border-color: #f1b0b7;}
        .status-advance { background-image: linear-gradient(to right, #d1ecf1, #bee5eb); color: #0c5460; border-color: #abdde5;} 
        .status-pending { background-image: linear-gradient(to right, #fff3cd, #ffeeba); color: #856404; border-color: #ffe8a1;}

        .controls { margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center; }
        .page-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .main-save-controls { 
            margin-top: 45px; 
            padding-top: 35px; 
            border-top: 2px solid;
            border-image-slice: 1;
            border-image-source: linear-gradient(to right, var(--primary-color-light), var(--primary-color-dark));
            text-align: center; 
        }
        .main-save-controls .btn-save-app-html { 
            font-size: 1.35em; 
            padding: 18px 40px; 
            width: 100%; 
            max-width: 550px; 
            font-weight: 700; 
        }

        .welcome-message { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background-image: linear-gradient(to right, var(--primary-color), var(--primary-color-dark)); 
            color: white; 
            padding: 20px 30px; 
            border-radius: var(--border-radius-lg); 
            margin-bottom: 35px; 
            box-shadow: var(--box-shadow-medium); 
        }
        .welcome-message h3 { 
            margin: 0; font-size: 1.6em; font-weight: 600; color: white; border-bottom: none;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        .welcome-message #back-to-login-btn { 
            background-color: rgba(255,255,255,0.15); 
            color: white; 
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.4);
            box-shadow: none;
        }
        .welcome-message #back-to-login-btn:hover { 
            background-color: rgba(255,255,255,0.25); 
            border-color: rgba(255,255,255,0.6);
        }
        
        #user-profile-section { display: none; } /* Initially hidden */
        #user-profile-section .btn-group { justify-content: space-between; }


        #admin-dashboard { border-left: 6px solid var(--danger-color); }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .admin-header h2 { margin-bottom: 0; border-bottom: none; }
        #admin-dashboard h2 { color: var(--danger-color); }

        .styled-list { list-style-type: none; padding-left: 0; }
        .tenant-list-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 16px 20px; 
            border-bottom: 1px solid #e9ecef; 
            flex-wrap: wrap; 
            gap: 12px; 
            background-color: #fff; 
            border-radius: var(--border-radius-md); 
            margin-bottom: 15px;
            box-shadow: var(--box-shadow-soft);
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .tenant-list-item:hover { background-color: #f8f9fa; transform: translateX(5px); }
        .tenant-list-item:last-child { border-bottom: none; }
        .tenant-list-item span.tenant-name-display { font-weight: 600; flex-grow: 1; font-size: 1.1em; color: var(--dark-color); }
        .tenant-list-item .actions { display: flex; gap: 10px; }
        .login-user-item { display: flex; align-items: center; justify-content: space-between; }
        .login-user-item .btn-delete-user { margin-left: 15px; }

        .modal { 
            display: none; 
            position: fixed; 
            z-index: 1050; 
            left: 0; top: 0; 
            width: 100%; height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.5); 
            backdrop-filter: blur(6px); 
            -webkit-backdrop-filter: blur(6px);
            padding-top: 40px;
        }
        .modal-content { 
            background-color: var(--card-bg); 
            margin: 4% auto; 
            padding: 35px 40px; 
            border: 1px solid #bbb; 
            width: 90%; 
            max-width: 600px; 
            border-radius: var(--border-radius-lg); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.25), 0 0 0 5px rgba(255,255,255,0.1); 
            animation: modalOpen 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            position: relative;
        }
        @keyframes modalOpen { 
            from { opacity: 0; transform: translateY(-40px) scale(0.92); } 
            to { opacity: 1; transform: translateY(0) scale(1); } 
        }
        .modal-content .btn-group { 
            margin-top: 35px; 
            display: flex; 
            justify-content: flex-end; 
            gap: 15px; 
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
        }
        .close-modal-btn {
            color: #999;
            font-size: 30px;
            font-weight: bold;
            position: absolute;
            top: 18px;
            right: 25px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .close-modal-btn:hover, .close-modal-btn:focus {
            color: var(--danger-color);
            text-decoration: none;
            cursor: pointer;
            transform: scale(1.1);
        }

        .initial-login-options { 
            text-align: center; 
            margin: 35px 0;
            display: flex;
            gap: 25px;
            justify-content: center;
        }
        .initial-login-options .btn { 
            width: auto; 
            padding: 14px 32px;
            font-size: 1.15em;
        }

        /* Responsive Design */
        @media (max-width: 768px) { 
            body { padding: 15px; font-size: 15px;} 
            .container { padding: 0 10px; margin: 15px auto; } 
            header h1 { font-size: 2.2em; } 
            h2, h3.modal-title { font-size: 1.7em; } 
            .card { padding: 25px; } 
            .btn { font-size: 1em; padding: 12px 22px; } 
            .welcome-message h3 { font-size: 1.4em; } 
            .main-save-controls .btn-save-app-html {font-size: 1.25em; padding: 16px 32px;} 
            .modal-content { margin: 8% auto; width: 92%; padding: 25px 30px;} 
            .initial-login-options { flex-direction: column; gap: 15px; }
            .initial-login-options .btn { width: 100%; }
            .tenant-details-grid, .default-values-grid { grid-template-columns: 1fr; gap: 22px; }
            .tenant-info-premium { padding: 30px; }
        }

        @media (max-width: 480px) { 
            body { padding: 10px; }
            header h1 { font-size: 1.9em; } 
            h2, h3.modal-title { font-size: 1.5em; } 
            .btn { padding: 10px 18px; font-size: 0.95em;} 
            .billing-record-card { padding: 20px 18px; } 
            .billing-record-card .card-header h4 { font-size: 1.25em; } 
            .billing-record-card .card-actions { flex-direction: column; align-items: stretch; } 
            .billing-record-card .card-actions .btn-small { width: 100%; margin-bottom: 8px; } 
            .tenant-list-item { flex-direction: column; align-items: flex-start; }
            .tenant-list-item .actions { width: 100%; margin-top: 10px; justify-content: flex-start;} 
            .main-save-controls .btn-save-app-html {font-size: 1.1em; padding: 14px 25px;} 
            .modal-content { margin: 6% auto; padding: 20px 25px; } 
            h3.modal-title {font-size: 1.4em;}
            .welcome-message { flex-direction: column; align-items: flex-start; gap: 12px; padding: 18px 22px;}
            .welcome-message #back-to-login-btn { width: 100%; text-align: center;}
            .depositF-group, .currentC-paid-amount-group { margin-left: -10px; margin-right: -10px; padding: 12px;}
        }

        /* Data Export Modal Styling */
        #data-export-modal .modal-content { max-width: 700px; }
        #exported-json-data {
            width: 100%;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            padding: 10px;
            font-family: monospace;
            font-size: 0.9em;
            background-color: #f8f9fa;
            border-radius: var(--border-radius-sm);
            white-space: pre-wrap; /* Important for JSON formatting */
        }
    </style>


    <div class="container">
        <header>
            <h1>‡¶¨‡¶æ‡ßú‡¶ø ‡¶≠‡¶æ‡ßú‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü <span class="header-edition">(‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶∏‡¶Ç‡¶∏‡ßç‡¶ï‡¶∞‡¶£ ‡ß©.‡ßß - ‡¶ñ‡¶∏‡ßú‡¶æ ‡¶ì ‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶° ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶∂‡¶®)</span></h1>
        </header>

        <!-- User Profile/Cloud Connect Section (Initially Hidden) -->
        <section id="user-profile-section" class="card" style="display: none;">
            <h2><i class="icon-profile"></i> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶ì ‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶° ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó</h2>
            <!-- ‡¶è‡¶á div ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
            <div class="page-actions" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color);">
                <button id="profile-back-to-initial-btn" class="btn btn-info"><i class="icon-back"></i> ‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶™‡ßá‡¶á‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
            </div>
            <div id="user-info-display" style="margin-bottom:20px;">
                <p>‡¶á‡¶Æ‡ßá‡¶á‡¶≤: <span id="display-user-email">ahshahriar.true7@gmail.com</span></p>
            </div>
            <div class="form-group">
                <label for="profile-email">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ (Google Account):</label>
                <input type="email" id="profile-email" placeholder="example@gmail.com" class="auto-expand" style="height: 55px;">
            </div>
            <!-- Google Sign-In button can be placed here if using Google Identity Services -->
            <!-- <div id="g_id_onload"
                 data-client_id="YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com"
                 data-callback="handleGoogleSignIn">
            </div>
            <div class="g_id_signin" data-type="standard"></div> -->
            
            <!-- ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶®‡ßã‡¶ü‡¶ü‡¶ø ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã -->
            <p class="note"><b>‡¶¨‡¶ø‡¶É‡¶¶‡ßç‡¶∞‡¶É</b> ‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡¶∞‡ßÇ‡¶™‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá (‡¶ï‡ßç‡¶≤‡¶æ‡ßü‡ßá‡¶®‡ßç‡¶ü-‡¶∏‡¶æ‡¶á‡¶°) ‡¶ö‡¶≤‡ßá‡•§ ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø Google Drive ‡¶¨‡¶æ Google Docs-‡¶è ‡¶∏‡ßç‡¶¨‡ßü‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶≠‡¶æ‡¶¨‡ßá ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞-‡¶∏‡¶æ‡¶á‡¶° ‡¶â‡¶™‡¶æ‡¶¶‡¶æ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ Google API-‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ü‡¶∞‡¶ì ‡¶ú‡¶ü‡¶ø‡¶≤ ‡¶á‡¶®‡ßç‡¶ü‡¶ø‡¶ó‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶® ‡¶π‡ßü (‡¶Ø‡ßá‡¶Æ‡¶® Google Sign-In ‡¶è‡¶¨‡¶Ç Drive API ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá OAuth2 ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£‡ßÄ‡¶ï‡¶∞‡¶£)‡•§ ‡¶è‡¶á ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶á‡¶®‡ßç‡¶ü‡¶ø‡¶ó‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶ï‡¶æ‡¶†‡¶æ‡¶Æ‡ßã‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá‡•§</p>
            <p class="note">‡¶Ü‡¶™‡¶æ‡¶§‡¶§, "‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶°‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶® (JSON)" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶°‡ßá‡¶ü‡¶æ‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ï‡¶™‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡¶Ø‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø Google Docs, Google Drive-‡¶è ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶´‡¶æ‡¶á‡¶≤ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá, ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶° ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§</p>
            <p class="note" style="font-size: 0.85em;"><b>‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø:</b> ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡¶¶‡¶ø Google Apps Script ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶è‡¶ï‡¶ü‡¶ø Apps Script Web App ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá ‡¶è‡¶á HTML ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨, ‡¶Ø‡¶æ ‡¶™‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ Google Sheet ‡¶¨‡¶æ Doc-‡¶è ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡•§ ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø Apps Script ‡¶è‡¶¨‡¶Ç Web App Deployment ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶ß‡¶æ‡¶∞‡¶£‡¶æ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§</p>

             <div class="btn-group">
                <button id="login-profile-btn" class="btn btn-primary" style="display: none;"><i class="icon-login"></i> ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶≤‡¶ó‡¶á‡¶®/‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button id="logout-profile-btn" class="btn btn-secondary" style="display: inline-block;"><i class="icon-logout"></i> ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
            <p id="profile-message" class="error-message" style="display:none;"></p>
        </section>


        <section id="initial-view" class="card" style="display: none;">
            <h2>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2>
            <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡¶æ‡ßú‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®:</p>
            <div class="initial-login-options">
                <button id="show-user-profile-btn" class="btn btn-info"><i class="icon-profile"></i> ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤/‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶° ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç</button>
                <button id="show-login-form-btn" class="btn btn-primary"><i class="icon-login"></i> ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶Ü‡¶á‡¶°‡¶ø‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶®</button>
                <button id="show-register-form-btn" class="btn btn-success"><i class="icon-register"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <div id="load-draft-prompt" style="display: none; margin-top: 20px;" class="note">
                <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ñ‡¶∏‡ßú‡¶æ (<span id="draft-user-name">Shahriar</span> ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø) ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶ü‡¶ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?</p>
                <button id="confirm-load-draft-btn" class="btn btn-success btn-small">‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button id="cancel-load-draft-btn" class="btn btn-secondary btn-small">‡¶®‡¶æ, ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <p class="note" style="margin-top: 30px;"><b>‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶®‡¶æ:</b> ‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶á HTML ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡ßá‡•§ ‡¶∏‡¶ï‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá, ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶è‡¶ï‡¶¶‡¶Æ ‡¶®‡¶ø‡¶ö‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶∏‡¶¨‡ßÅ‡¶ú ‡¶∞‡¶ô‡ßá‡¶∞ <b>"‡¶∏‡¶ï‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶è‡¶á ‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°)"</b> ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
        </section>

        <!-- Login, Register, Modals (HTML structure remains largely the same as previous version) -->
        <section id="login-form-section" class="card" style="display: none;">
            <h2>‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <div class="form-group">
                <label for="login-username-dropdown">‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®):</label>
                <div id="login-username-dropdown-container"><select id="login-username-dropdown" class="auto-expand" style="height: 56px;"><option value="">-- ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® --</option><option value="Shahriar">Shahriar</option></select></div>
            </div>
            <div class="form-group">
                <label for="login-admin-username">‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®/‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ:</label>
                <input type="text" id="login-admin-username" placeholder="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶¨‡¶æ ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®" class="auto-expand" style="height: 60px;" disabled="">
            </div>
            <div class="form-group">
                <label for="login-password">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° / ‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡¶ï‡ßã‡¶°:</label>
                <input type="password" id="login-password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¨‡¶æ ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®">
            </div>
            <button id="login-submit-btn" class="btn btn-primary"><i class="icon-submit"></i> ‡¶≤‡¶ó‡¶á‡¶®</button>
            <button id="back-to-initial-view-from-login-2" class="btn btn-secondary"><i class="icon-back"></i> ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
            <p id="login-error" class="error-message" style="display:none;"></p>
        </section>

        <div id="register-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-modal-btn" data-modal-id="register-modal">√ó</span>
                <h3 class="modal-title">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="form-group"> <label for="register-username">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß© ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞):</label> <input type="text" id="register-username" placeholder="‡¶è‡¶ï‡¶ü‡¶ø ‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®" class="auto-expand" style="height: 60px;"> </div>
                <div class="form-group"> <label for="register-password">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° (‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß™ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞):</label> <input type="password" id="register-password" placeholder="‡¶è‡¶ï‡¶ü‡¶ø ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®"> </div>
                <div class="form-group"> <label for="register-confirm-password">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°‡¶ü‡¶ø ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡ßü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:</label> <input type="password" id="register-confirm-password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°‡¶ü‡¶ø ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®"> </div>
                <p id="register-error" class="error-message" style="display:none;"></p>
                <div class="btn-group"> <button id="register-submit-btn" class="btn btn-success"><i class="icon-register"></i> ‡¶Ü‡¶á‡¶°‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button> <button id="cancel-register-btn" type="button" class="btn btn-secondary" data-modal-id="register-modal"><i class="icon-cancel"></i> ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</button> </div>
            </div>
        </div>
        
        <div id="add-month-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-modal-btn" data-modal-id="add-month-modal">√ó</span>
                <h3 class="modal-title">‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="form-group"> <label for="new-bill-year">‡¶¨‡¶õ‡¶∞:</label> <select id="new-bill-year" class="auto-expand" style="height: 56px;"><option value="2022">2022</option><option value="2023">2023</option><option value="2024">2024</option><option value="2025">2025</option><option value="2026">2026</option><option value="2027">2027</option><option value="2028">2028</option><option value="2029">2029</option><option value="2030">2030</option></select> </div>
                <div class="form-group"> <label for="new-bill-month">‡¶Æ‡¶æ‡¶∏:</label> <select id="new-bill-month" class="auto-expand" style="height: 56px;"><option value="1">‡¶ú‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø</option><option value="2">‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø</option><option value="3">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö</option><option value="4">‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤</option><option value="5">‡¶Æ‡ßá</option><option value="6">‡¶ú‡ßÅ‡¶®</option><option value="7">‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á</option><option value="8">‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü</option><option value="9">‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞</option><option value="10">‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞</option><option value="11">‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞</option><option value="12">‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞</option></select> </div>
                <p id="add-month-error" class="error-message" style="display:none;"></p>
                <div class="btn-group"> <button id="confirm-add-month-btn" class="btn btn-success"><i class="icon-add"></i> ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button> <button type="button" class="btn btn-secondary" data-modal-id="add-month-modal"><i class="icon-cancel"></i> ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button> </div>
            </div>
        </div>

        <div id="confirmation-modal" class="modal">
            <div class="modal-content">
                 <span class="close-modal-btn" data-modal-id="confirmation-modal">√ó</span>
                <h3 class="modal-title" id="confirmation-modal-title">‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶ï‡¶∞‡¶£</h3>
                <p id="confirmation-modal-message">‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶ü‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?</p>
                <div class="btn-group"> <button id="confirm-action-btn" class="btn btn-danger"><i class="icon-confirm"></i> ‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§</button> <button id="cancel-action-btn" class="btn btn-secondary" data-modal-id="confirmation-modal"><i class="icon-cancel"></i> ‡¶®‡¶æ, ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button> </div>
            </div>
        </div>
        
        <!-- Data Export Modal for Cloud Save Simulation -->
        <div id="data-export-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal-btn" data-modal-id="data-export-modal">√ó</span>
                <h3 class="modal-title">‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü (JSON)</h3>
                <p>‡¶®‡¶ø‡¶ö‡ßá‡¶∞ JSON ‡¶°‡ßá‡¶ü‡¶æ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Google Docs ‡¶¨‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                <textarea id="exported-json-data" readonly="" class="auto-expand" style="height: 5px;"></textarea>
                <div class="btn-group">
                    <button id="copy-json-btn" class="btn btn-primary"><i class="icon-save"></i> JSON ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button type="button" class="btn btn-secondary" data-modal-id="data-export-modal"><i class="icon-cancel"></i> ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>


        <section id="admin-dashboard" class="card" style="display:none;">
            <div class="admin-header"> <h2><i class="icon-admin"></i> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2> <button id="admin-logout-btn" class="btn btn-secondary btn-small"><i class="icon-logout"></i> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button> </div>
            <div class="page-actions">
                 <button id="admin-back-to-initial-view-btn" class="btn btn-info"><i class="icon-back"></i> ‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶™‡ßá‡¶á‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
            </div>
            <p>‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶ø‡¶§ ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§</p>
            <div id="admin-tenant-list-container" style="margin-top: 20px;"> <h3><i class="icon-users"></i> ‡¶∏‡¶ï‡¶≤ ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶ø‡¶§ ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ:</h3> <ul id="admin-tenant-list" class="styled-list"></ul> </div>
            <div class="main-save-controls"> <button id="admin-save-all-data-html-btn" class="btn btn-save-app-html"><i class="icon-save"></i> ‡¶∏‡¶ï‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶π ‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶∏‡ßá‡¶≠)</button> </div>
        </section>

        <main id="app-content" style="display: block;">
            <div class="welcome-message"> 
                <h3>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, <span id="display-tenant-name">Shahriar</span>! <span id="cloud-status-indicator" style="font-size:0.7em; opacity:0.7;">(ahshahriar.true7@gmail.com ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§)</span></h3> 
                <button id="back-to-login-btn" class="btn btn-light"><i class="icon-logout"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü / ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button> 
            </div>
             <div class="page-actions">
                <button id="save-draft-btn" class="btn btn-info"><i class="icon-draft"></i> ‡¶ñ‡¶∏‡ßú‡¶æ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button id="save-to-cloud-btn" class="btn btn-warning"><i class="icon-cloud-save"></i> ‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶°‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶® (JSON)</button>
            </div>
            
            <section id="tenant-info-section" class="card tenant-info-premium"> 
                <h2><i class="icon-info"></i> ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶§‡¶•‡ßç‡¶Ø</h2> 
                <div class="tenant-details-grid"> 
                    <div class="form-group"> <label for="tenant-name"><i class="icon-user"></i> ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶ø‡¶§ ‡¶®‡¶æ‡¶Æ:</label> <input type="text" id="tenant-name" readonly="" class="readonly-input auto-expand" style="height: 60px;"> </div> 
                    <div class="form-group"> <label for="tenant-mobile"><i class="icon-mobile"></i> ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label> <input type="text" id="tenant-mobile" class="auto-expand" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" style="height: 60px;"> </div> 
                    <div class="form-group"> <label for="tenant-meter"><i class="icon-meter"></i> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label> <input type="text" id="tenant-meter" class="auto-expand" placeholder="‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" style="height: 60px;"> </div> 
                    <div class="form-group"> <label for="tenant-customer-id"><i class="icon-id"></i> ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø:</label> <input type="text" id="tenant-customer-id" class="auto-expand" placeholder="‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø" style="height: 60px;"> </div> 
                    <div class="form-group"> <label for="tenant-advance"><i class="icon-advance-taka"></i> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ (‡¶ü‡¶æ‡¶ï‡¶æ):</label> <input type="number" id="tenant-advance" class="auto-expand" placeholder="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶ü‡¶æ‡¶ï‡¶æ" style="height: 55px;"> </div> 
                    <div class="form-group"> <label for="tenant-nid"><i class="icon-nid"></i> NID ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label> <input type="text" id="tenant-nid" class="auto-expand" placeholder="NID ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" style="height: 60px;"> </div> 
                </div> 
                <h3 class="sub-heading"><i class="icon-defaults"></i> ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
                <div class="default-values-grid"> 
                    <div class="form-group"> <label for="default-rent"><i class="icon-rent"></i> ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶≠‡¶æ‡ßú‡¶æ (A):</label> <input type="number" id="default-rent" class="auto-expand" placeholder="‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶≠‡¶æ‡ßú‡¶æ" style="height: 55px;"> </div> 
                    <div class="form-group"> <label for="default-gas"><i class="icon-gas"></i> ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏ ‡¶¨‡¶ø‡¶≤ (B):</label> <input type="number" id="default-gas" class="auto-expand" placeholder="‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏ ‡¶¨‡¶ø‡¶≤" style="height: 55px;"> </div> 
                </div> 
            </section>
            
            <section id="billing-section" class="card"> 
                <h2><i class="icon-billing"></i> ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°‡¶∏</h2> 
                <div class="controls"> 
                    <button id="add-month-btn" class="btn btn-success"><i class="icon-add-bill"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button> 
                </div> 
                <div id="billing-records-container"><div class="billing-record-card" data-id="record_1750701335127_2tdsp7a50"><div class="card-header"><h4>‡¶¨‡¶ø‡¶≤: ‡¶ú‡ßÅ‡¶®, 2025</h4><div class="card-actions"><button type="button" class="btn btn-secondary btn-small toggle-content-btn"><i class="icon-hide"></i> ‡¶π‡¶æ‡¶á‡¶°</button><button type="button" class="btn btn-small btn-warning confirm-record-btn"><i class="icon-confirm"></i> ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ</button><button type="button" class="btn btn-danger btn-small delete-record-btn"><i class="icon-delete"></i> ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button></div></div><div class="card-content"><div class="form-group "><label>‡¶≠‡¶æ‡ßú‡¶æ (A):</label><div class=""><input type="number" class="rentA auto-expand" placeholder="0.00" step="0.01" style="height: 47px;"></div></div><div class="form-group "><label>‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏ (B):</label><div class=""><input type="number" class="gasB auto-expand" placeholder="0.00" step="0.01" style="height: 47px;"></div></div><div class="form-group "><label>‡¶ï‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶≤ (C):</label><div class=""><input type="number" class="currentC auto-expand" placeholder="0.00" step="0.01" style="height: 47px;"></div></div><div class="form-group currentC-paid-amount-group not-paid"><label>‡¶ï‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶≤ ‡¶ú‡¶Æ‡¶æ (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá):</label><div class="input-with-meta"><input type="number" step="0.01" class="currentCPaidAmount auto-expand" placeholder="0.00" style="height: 47px;"><button type="button" class="btn btn-small btn-danger currentC-paid-btn">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></div><div class="form-group "><label>‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (D):</label><div class=""><input type="number" class="vatD auto-expand" placeholder="0.00" step="0.01" style="height: 47px;"></div></div><div class="form-group "><label>‡¶∏‡¶æ‡¶¨-‡¶ü‡ßã‡¶ü‡¶æ‡¶≤ (X = A+B+C+D):</label><div class=""><input type="number" class="subTotalX auto-expand readonly-calc-field" step="0.01" readonly="" style="height: 47px;"></div></div><div class="form-group "><label>‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ (H):</label><div class=""><input type="number" class="prevArrearsH auto-expand" placeholder="0.00" step="0.01" style="height: 47px;"></div></div><div class="form-group "><label>‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶¶‡ßá‡ßü (T = X+H):</label><div class=""><input type="number" class="totalAmountT-field auto-expand readonly-calc-field" step="0.01" readonly="" style="height: 47px;"></div></div><div class="form-group depositF-group has-deposit"><label>‡¶Æ‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ (F):</label><div class="input-with-meta"><input type="number" class="depositF auto-expand" placeholder="0.00" step="0.01" style="height: 47px;"><span class="input-meta-info deposit-date-display">(‡ß®‡ß©/‡ß¶‡ß¨/‡ß®‡ß¶‡ß®‡ß´)</span></div></div><div class="form-group "><label>‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ï‡ßá‡ßü‡¶æ/‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ (G = T-F):</label><div class=""><input type="number" class="newArrearsG auto-expand readonly-calc-field" step="0.01" readonly="" style="height: 47px;"></div></div><div class="form-group "><label>‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø:</label><div class=""><textarea class="comment auto-expand" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá)" style="height: 84px;"></textarea></div></div><div class="status-display status-paid">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</div></div></div></div> 
                <p id="no-records-message" class="note" style="display: none; text-align: center; padding: 20px;">‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§</p> 
            </section>
            
            <div class="main-save-controls"> 
                <button id="download-updated-html-btn" class="btn btn-save-app-html"><i class="icon-save-file"></i> ‡¶∏‡¶ï‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶è‡¶á ‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°)</button> 
            </div>
        </main>
    </div>
    
    <script id="app-data-store" type="application/json">{
  "users": {
    "tenant_shahriar_12345": {
      "tenantId": "tenant_shahriar_12345",
      "loginName": "Shahriar",
      "data": {
        "info": {
          "name": "Shahriar",
          "mobile": "",
          "meter": "",
          "customerId": "",
          "advance": "",
          "nid": "",
          "defaultRent": "1200",
          "defaultGas": "5000"
        },
        "billingRecords": [
          {
            "id": "record_1750701335127_2tdsp7a50",
            "year": 2025,
            "month": 6,
            "rentA": 1200,
            "gasB": 5000,
            "currentC": 0,
            "currentCPaidAmount": 0,
            "currentCPaid": false,
            "vatD": 0,
            "prevArrearsH": 0,
            "depositF": 6200,
            "depositDate": "2025-06-23T17:55:48.307Z",
            "comment": "",
            "confirmed": false,
            "hidden": false,
            "subTotalX": 6200,
            "totalAmountT": 6200,
            "newArrearsG": 0
          }
        ]
      }
    }
  },
  "user_profiles": {
    "ahshahriar.true7@gmail.com": {
      "profileEmail": "ahshahriar.true7@gmail.com",
      "tenantId": "tenant_shahriar_12345",
      "loginName": "Shahriar",
      "data": {
        "info": {
          "name": "Shahriar",
          "mobile": "",
          "meter": "",
          "customerId": "",
          "advance": "",
          "nid": "",
          "defaultRent": "1200",
          "defaultGas": "5000"
        },
        "billingRecords": [
          {
            "id": "record_1750701335127_2tdsp7a50",
            "year": 2025,
            "month": 6,
            "rentA": 1200,
            "gasB": 5000,
            "currentC": 0,
            "currentCPaidAmount": 0,
            "currentCPaid": false,
            "vatD": 0,
            "prevArrearsH": 0,
            "depositF": 6200,
            "depositDate": "2025-06-23T17:55:48.307Z",
            "comment": "",
            "confirmed": false,
            "hidden": false,
            "subTotalX": 6200,
            "totalAmountT": 6200,
            "newArrearsG": 0
          }
        ]
      }
    }
  }
}</script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const MASTER_USERNAME = "admin";
            const MASTER_PASSWORD = "yourSecurePassword123!";

            const elements = {
                // ... (‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶∏‡¶¨ elements ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá) ...
                initialView: document.getElementById('initial-view'),
                showUserProfileBtn: document.getElementById('show-user-profile-btn'),
                profileBackToInitialBtn: document.getElementById('profile-back-to-initial-btn'), // ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
                userProfileSection: document.getElementById('user-profile-section'),
                profileEmailInput: document.getElementById('profile-email'),
                loginProfileBtn: document.getElementById('login-profile-btn'),
                logoutProfileBtn: document.getElementById('logout-profile-btn'),
                displayUserEmail: document.getElementById('display-user-email'),
                profileMessage: document.getElementById('profile-message'),
                cloudStatusIndicator: document.getElementById('cloud-status-indicator'),

                showLoginFormBtn: document.getElementById('show-login-form-btn'),
                showRegisterFormBtn: document.getElementById('show-register-form-btn'),
                loginFormSection: document.getElementById('login-form-section'),
                loginUsernameDropdownContainer: document.getElementById('login-username-dropdown-container'),
                loginAdminUsernameInput: document.getElementById('login-admin-username'),
                loginPasswordInput: document.getElementById('login-password'),
                loginSubmitBtn: document.getElementById('login-submit-btn'),
                loginError: document.getElementById('login-error'),
                backToInitialViewFromLogin2: document.getElementById('back-to-initial-view-from-login-2'), // Changed ID
                
                registerModal: document.getElementById('register-modal'),
                registerUsernameInput: document.getElementById('register-username'),
                registerPasswordInput: document.getElementById('register-password'),
                registerConfirmPasswordInput: document.getElementById('register-confirm-password'),
                registerSubmitBtn: document.getElementById('register-submit-btn'),
                cancelRegisterBtn: document.getElementById('cancel-register-btn'),
                registerError: document.getElementById('register-error'),

                addMonthModal: document.getElementById('add-month-modal'),
                newBillYearSelect: document.getElementById('new-bill-year'),
                newBillMonthSelect: document.getElementById('new-bill-month'),
                confirmAddMonthBtn: document.getElementById('confirm-add-month-btn'),
                addMonthError: document.getElementById('add-month-error'),

                confirmationModal: document.getElementById('confirmation-modal'),
                confirmationModalTitle: document.getElementById('confirmation-modal-title'),
                confirmationModalMessage: document.getElementById('confirmation-modal-message'),
                confirmActionBtn: document.getElementById('confirm-action-btn'),
                cancelActionBtn: document.getElementById('cancel-action-btn'),
                
                dataExportModal: document.getElementById('data-export-modal'),
                exportedJsonDataTextarea: document.getElementById('exported-json-data'),
                copyJsonBtn: document.getElementById('copy-json-btn'),


                appContent: document.getElementById('app-content'),
                saveDraftBtn: document.getElementById('save-draft-btn'),
                saveToCloudBtn: document.getElementById('save-to-cloud-btn'),
                loadDraftPrompt: document.getElementById('load-draft-prompt'),
                draftUserNameSpan: document.getElementById('draft-user-name'),
                confirmLoadDraftBtn: document.getElementById('confirm-load-draft-btn'),
                cancelLoadDraftBtn: document.getElementById('cancel-load-draft-btn'),

                adminDashboard: document.getElementById('admin-dashboard'),
                adminLogoutBtn: document.getElementById('admin-logout-btn'),
                adminBackToInitialViewBtn: document.getElementById('admin-back-to-initial-view-btn'),
                displayTenantName: document.getElementById('display-tenant-name'),
                backToLoginBtn: document.getElementById('back-to-login-btn'),
                
                tenantNameInput: document.getElementById('tenant-name'),
                tenantMobileInput: document.getElementById('tenant-mobile'),
                tenantMeterInput: document.getElementById('tenant-meter'),
                tenantCustomerIdInput: document.getElementById('tenant-customer-id'),
                tenantAdvanceInput: document.getElementById('tenant-advance'),
                tenantNidInput: document.getElementById('tenant-nid'),
                defaultRentInput: document.getElementById('default-rent'),
                defaultGasInput: document.getElementById('default-gas'),

                addMonthBtn: document.getElementById('add-month-btn'),
                downloadUpdatedHtmlBtn: document.getElementById('download-updated-html-btn'),
                adminDownloadAllDataHtmlBtn: document.getElementById('admin-save-all-data-html-btn'),
                
                billingRecordsContainer: document.getElementById('billing-records-container'),
                noRecordsMessage: document.getElementById('no-records-message'),
                appDataStoreScript: document.getElementById('app-data-store'),
                adminTenantList: document.getElementById('admin-tenant-list')
            };

            let masterAppData = { users: {}, user_profiles: {} }; // Added user_profiles
            let currentTenantId = null;
            let currentTenantLoginName = '';
            let currentTenantData = {};
            let isAdminLoggedIn = false;
            let loggedInUserEmail = null; // For profile/cloud
            const monthNamesBn = ["‡¶ú‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø", "‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø", "‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö", "‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤", "‡¶Æ‡ßá", "‡¶ú‡ßÅ‡¶®", "‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á", "‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü", "‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞", "‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞", "‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞", "‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞"];
            let rainbowIntervalId = null;
            let confirmActionCallback = null;

            function setPrimaryColorRGB() {
                const primaryColorHex = getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim();
                if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(primaryColorHex)) {
                    let hex = primaryColorHex.substring(1);
                    if (hex.length === 3) hex = hex.split('').map(char => char + char).join('');
                    const r = parseInt(hex.substring(0, 2), 16);
                    const g = parseInt(hex.substring(2, 4), 16);
                    const b = parseInt(hex.substring(4, 6), 16);
                    document.documentElement.style.setProperty('--rgb-primary-color', `${r},${g},${b}`);
                }
            }
            setPrimaryColorRGB();

            function autoExpandField(field) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                if (!field || typeof field.style === 'undefined') return;
                field.style.height = 'auto';
                let scrollHeight = field.scrollHeight;
                let buffer = ((field.tagName.toLowerCase() === 'input' && field.type === 'text') || field.tagName.toLowerCase() === 'textarea') ? 5 : 0;
                if (field.tagName.toLowerCase() === 'select') {
                    if (scrollHeight < 56) scrollHeight = 56;
                }
                field.style.height = (scrollHeight + buffer) + 'px';
            }

            function setupAutoExpandListeners(parentElement = document) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                parentElement.querySelectorAll('input.auto-expand, textarea.auto-expand, select.auto-expand').forEach(field => {
                    field.removeEventListener('input', handleAutoExpandInput);
                    field.addEventListener('input', handleAutoExpandInput);
                    if (field.tagName.toLowerCase() === 'select') {
                        field.removeEventListener('change', handleAutoExpandInput);
                        field.addEventListener('change', handleAutoExpandInput);
                    }
                    setTimeout(() => autoExpandField(field), 150);
                });
            }
            function handleAutoExpandInput(event) { autoExpandField(event.target); }

            function loadInitialData() {
                try {
                    const embeddedDataRaw = elements.appDataStoreScript.textContent;
                    if (embeddedDataRaw && embeddedDataRaw.trim() !== "" && embeddedDataRaw.trim() !== "{}") {
                        const parsedData = JSON.parse(embeddedDataRaw);
                        if (parsedData) {
                            masterAppData.users = (parsedData.users && typeof parsedData.users === 'object') ? parsedData.users : {};
                            masterAppData.user_profiles = (parsedData.user_profiles && typeof parsedData.user_profiles === 'object') ? parsedData.user_profiles : {};
                            
                            Object.values(masterAppData.users).forEach(userDataContainer => {
                                if (userDataContainer.data && userDataContainer.data.billingRecords) {
                                    userDataContainer.data.billingRecords.forEach(rec => {
                                        rec.confirmed = !!rec.confirmed; rec.hidden = !!rec.hidden;
                                        if (typeof rec.currentCPaid === 'undefined') rec.currentCPaid = false;
                                        if (typeof rec.currentCPaidAmount === 'undefined') rec.currentCPaidAmount = 0;
                                        if (typeof rec.depositDate === 'undefined') rec.depositDate = null;
                                        if (rec.prevArrearsH && typeof rec.prevArrearsH === 'string') rec.prevArrearsH = parseFloat(rec.prevArrearsH) || 0;
                                    });
                                }
                            });
                        }
                    }
                } catch (e) {
                    console.error("Error loading/parsing embedded data:", e);
                    masterAppData = { users: {}, user_profiles: {} };
                }
                // Load profile from localStorage if exists
                const storedEmail = localStorage.getItem('bariVaraAppUserEmail');
                if (storedEmail) {
                    loggedInUserEmail = storedEmail;
                    elements.profileEmailInput.value = storedEmail;
                    elements.displayUserEmail.textContent = storedEmail;
                    elements.loginProfileBtn.style.display = 'none';
                    elements.logoutProfileBtn.style.display = 'inline-block';
                    elements.cloudStatusIndicator.textContent = `(${storedEmail} ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§)`;
                }
            }

            function showView(viewToShow) {
                [elements.initialView, elements.loginFormSection, elements.appContent, elements.adminDashboard, elements.userProfileSection].forEach(view => {
                    if (view) view.style.display = 'none';
                });
                if (viewToShow) viewToShow.style.display = 'block';
            }
            
            function resetLoginState() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                isAdminLoggedIn = false; currentTenantId = null; currentTenantLoginName = ''; currentTenantData = {};
                if(elements.loginAdminUsernameInput) elements.loginAdminUsernameInput.value = '';
                if(elements.loginPasswordInput) elements.loginPasswordInput.value = '';
                if(elements.loginError) { elements.loginError.textContent = ''; elements.loginError.style.display = 'none';}
                if(elements.registerError) { elements.registerError.textContent = ''; elements.registerError.style.display = 'none';}
                stopRainbowEffect();
                elements.loadDraftPrompt.style.display = 'none'; // Hide draft prompt
            }

            function showInitialView() {
                showView(elements.initialView);
                resetLoginState();
                checkAndPromptForDraft(); // Check for draft when returning to initial view
            }
            
            function showUserProfileView() {
                showView(elements.userProfileSection);
                setupAutoExpandListeners(elements.userProfileSection);
            }

            function showLoginForm() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                showView(elements.loginFormSection);
                createLoginDropdown(); 
                elements.loginAdminUsernameInput.value = '';
                elements.loginPasswordInput.value = '';
                elements.loginAdminUsernameInput.disabled = false;
                elements.loginAdminUsernameInput.focus();
                setupAutoExpandListeners(elements.loginFormSection);
            }
            
            function createLoginDropdown() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                elements.loginUsernameDropdownContainer.innerHTML = '';
                const selectEl = document.createElement('select');
                selectEl.id = 'login-username-dropdown';
                selectEl.className = 'auto-expand';
                const defaultOption = document.createElement('option');
                defaultOption.value = ""; defaultOption.textContent = "-- ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® --";
                selectEl.appendChild(defaultOption);

                if (masterAppData.users) {
                    const sortedUserEntries = Object.entries(masterAppData.users)
                        .filter(([id, user]) => user.loginName && user.loginName !== MASTER_USERNAME)
                        .sort(([, userA], [, userB]) => (userA.loginName || "").localeCompare(userB.loginName || "", 'bn'));
                    sortedUserEntries.forEach(([tenantId, userContainer]) => {
                        const option = document.createElement('option');
                        option.value = userContainer.loginName;
                        option.textContent = userContainer.loginName;
                        selectEl.appendChild(option);
                    });
                }
                elements.loginUsernameDropdownContainer.appendChild(selectEl);
                autoExpandField(selectEl);
                selectEl.addEventListener('change', () => {
                    if (selectEl.value) {
                        elements.loginAdminUsernameInput.value = selectEl.value; 
                        elements.loginAdminUsernameInput.disabled = true; 
                    } else {
                        elements.loginAdminUsernameInput.disabled = false;
                    }
                    autoExpandField(selectEl);
                });
            }

            function showModal(modalElement) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                 if(modalElement) modalElement.style.display = 'block';
                setupAutoExpandListeners(modalElement.querySelector('.modal-content'));
            }
            function hideModal(modalElement) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                if(modalElement) modalElement.style.display = 'none';
            }
            
            document.querySelectorAll('.close-modal-btn, .btn[data-modal-id]').forEach(btn => { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                btn.addEventListener('click', function() {
                    const modalId = this.dataset.modalId;
                    if (modalId) {
                        const modalToClose = document.getElementById(modalId);
                        if (modalToClose) hideModal(modalToClose);
                    }
                });
            });

            function showRegisterModal() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                showModal(elements.registerModal);
                elements.registerUsernameInput.value = '';
                elements.registerPasswordInput.value = '';
                elements.registerConfirmPasswordInput.value = '';
                elements.registerError.textContent = '';
                elements.registerError.style.display = 'none';
                elements.registerUsernameInput.focus();
            }

            function switchToAppView(fromDraft = false) {
                showView(elements.appContent);
                elements.displayTenantName.textContent = currentTenantLoginName;
                if (!fromDraft) { // Only reset if not loading from draft
                    // currentTenantData is already set by login or draft load
                }
                displayTenantInfo();
                renderBillingRecords();
                setupAutoExpandListeners(elements.appContent);
                startRainbowEffect();
            }

            function switchToAdminDashboard() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                showView(elements.adminDashboard);
                isAdminLoggedIn = true; 
                populateAdminTenantList();
                stopRainbowEffect();
                setupAutoExpandListeners(elements.adminDashboard);
            }
            
            function showConfirmationModal(title, message, callback) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                elements.confirmationModalTitle.textContent = title;
                elements.confirmationModalMessage.innerHTML = message;
                confirmActionCallback = callback;
                showModal(elements.confirmationModal);
            }

            elements.confirmActionBtn.addEventListener('click', () => { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                if (typeof confirmActionCallback === 'function') {
                    confirmActionCallback();
                }
                hideModal(elements.confirmationModal);
                confirmActionCallback = null;
            });
            
            window.addEventListener('click', (event) => { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                 if (event.target.classList.contains('modal')) {
                    hideModal(event.target);
                }
            });
            
            // Profile/Cloud Connect Logic
            if(elements.showUserProfileBtn) elements.showUserProfileBtn.addEventListener('click', showUserProfileView);
            if(elements.profileBackToInitialBtn) elements.profileBackToInitialBtn.addEventListener('click', showInitialView); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá

            if(elements.loginProfileBtn) {
                elements.loginProfileBtn.addEventListener('click', () => {
                    const email = elements.profileEmailInput.value.trim();
                    if (email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { // Basic email validation
                        loggedInUserEmail = email;
                        localStorage.setItem('bariVaraAppUserEmail', email);
                        elements.displayUserEmail.textContent = email;
                        elements.profileMessage.textContent = `"${email}" ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`;
                        elements.profileMessage.style.color = 'var(--success-color)';
                        elements.profileMessage.style.display = 'block';
                        elements.loginProfileBtn.style.display = 'none';
                        elements.logoutProfileBtn.style.display = 'inline-block';
                        elements.cloudStatusIndicator.textContent = `(${email} ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§)`;
                        if (masterAppData.user_profiles && masterAppData.user_profiles[email]) {
                            alert(`"${email}" ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶°‡ßá‡¶ü‡¶æ (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá) ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá... (‡¶è‡¶á ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶ü‡ßá‡¶°)`);
                        }

                    } else {
                        elements.profileMessage.textContent = '‡¶∏‡¶†‡¶ø‡¶ï ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏ ‡¶¶‡¶ø‡¶®‡•§';
                        elements.profileMessage.style.color = 'var(--danger-color)';
                        elements.profileMessage.style.display = 'block';
                    }
                    autoExpandField(elements.profileEmailInput); // Expand after value change if needed
                });
            }
            if(elements.logoutProfileBtn) {
                elements.logoutProfileBtn.addEventListener('click', () => {
                    loggedInUserEmail = null;
                    localStorage.removeItem('bariVaraAppUserEmail');
                    elements.profileEmailInput.value = '';
                    elements.displayUserEmail.textContent = '‡¶è‡¶ñ‡¶®‡¶ì ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø';
                    elements.profileMessage.textContent = '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§';
                    elements.profileMessage.style.color = 'var(--info-color)';
                    elements.profileMessage.style.display = 'block';
                    elements.loginProfileBtn.style.display = 'inline-block';
                    elements.logoutProfileBtn.style.display = 'none';
                    elements.cloudStatusIndicator.textContent = '';
                    autoExpandField(elements.profileEmailInput); // Expand after value change
                });
            }


            if (elements.showLoginFormBtn) elements.showLoginFormBtn.addEventListener('click', showLoginForm);
            if (elements.showRegisterFormBtn) elements.showRegisterFormBtn.addEventListener('click', showRegisterModal);
            if (elements.backToInitialViewFromLogin2) elements.backToInitialViewFromLogin2.addEventListener('click', showInitialView);
            if (elements.adminBackToInitialViewBtn) elements.adminBackToInitialViewBtn.addEventListener('click', showInitialView);


            if (elements.loginSubmitBtn) {
                elements.loginSubmitBtn.addEventListener('click', () => {
                    const loginUsernameDropdown = elements.loginUsernameDropdownContainer.querySelector('select');
                    const dropdownName = loginUsernameDropdown ? loginUsernameDropdown.value : "";
                    const manualName = elements.loginAdminUsernameInput.value.trim();
                    const nameToLogin = dropdownName || manualName;
                    const passwordOrCode = elements.loginPasswordInput.value;
                    elements.loginError.textContent = ''; elements.loginError.style.display = 'none';

                    if (!nameToLogin || !passwordOrCode) {
                        elements.loginError.textContent = '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°/‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®‡•§';
                        elements.loginError.style.display = 'block'; return;
                    }

                    if (nameToLogin === MASTER_USERNAME && passwordOrCode === MASTER_PASSWORD) {
                        isAdminLoggedIn = true; 
                        switchToAdminDashboard(); return;
                    }
                    isAdminLoggedIn = false; 

                    const tempTenantId = `tenant_${nameToLogin.toLowerCase().replace(/\s+/g, '_')}_${passwordOrCode}`;
                    if (masterAppData.users && masterAppData.users[tempTenantId] && masterAppData.users[tempTenantId].loginName === nameToLogin) {
                        currentTenantId = tempTenantId;
                        currentTenantLoginName = masterAppData.users[tempTenantId].loginName;
                        currentTenantData = JSON.parse(JSON.stringify(masterAppData.users[tempTenantId].data));
                        switchToAppView();
                        clearDraftData(currentTenantId); // Clear draft after successful login & load
                    } else {
                        elements.loginError.textContent = '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°/‡¶ï‡ßã‡¶° ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
                        elements.loginError.style.display = 'block';
                    }
                });
            }

            if (elements.registerSubmitBtn) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á, ‡¶∂‡ßÅ‡¶ß‡ßÅ createLoginDropdown ‡¶ï‡¶≤ ‡¶π‡¶¨‡ßá ... */ 
                elements.registerSubmitBtn.addEventListener('click', () => {
                    const username = elements.registerUsernameInput.value.trim();
                    const password = elements.registerPasswordInput.value;
                    const confirmPassword = elements.registerConfirmPasswordInput.value;
                    elements.registerError.textContent = ''; elements.registerError.style.display = 'none';

                    if (!username || username.length < 3) { elements.registerError.textContent = '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß© ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§'; elements.registerError.style.display = 'block'; return; }
                    if (!password || password.length < 4) { elements.registerError.textContent = '‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß™ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§'; elements.registerError.style.display = 'block'; return; }
                    if (password !== confirmPassword) { elements.registerError.textContent = '‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶Æ‡¶ø‡¶≤‡ßá‡¶®‡¶ø‡•§'; elements.registerError.style.display = 'block'; return; }
                    
                    const usernameExists = Object.values(masterAppData.users || {}).some(user => user.loginName.toLowerCase() === username.toLowerCase());
                    if (usernameExists) {
                        elements.registerError.textContent = '‡¶è‡¶á ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶ü‡¶ø ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶∞‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶®‡¶æ‡¶Æ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
                        elements.registerError.style.display = 'block'; return;
                    }

                    const newTenantId = `tenant_${username.toLowerCase().replace(/\s+/g, '_')}_${password}`;
                    if (username === MASTER_USERNAME) { elements.registerError.textContent = '‡¶è‡¶á ‡¶®‡¶æ‡¶Æ‡¶ü‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§‡•§ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶®‡¶æ‡¶Æ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'; elements.registerError.style.display = 'block'; return; }

                    if (!masterAppData.users) masterAppData.users = {};
                    masterAppData.users[newTenantId] = {
                        tenantId: newTenantId,
                        loginName: username,
                        data: initializeNewTenantDataStructure(username)
                    };
                    alert(`"${username}" ‡¶®‡¶æ‡¶Æ‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!\n‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£: ‡¶è‡¶á ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡¶ü‡¶ø ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ "‡¶∏‡¶ï‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶π ‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`);
                    hideModal(elements.registerModal);
                    showLoginForm(); // This will recreate dropdown
                });
            }

            if (elements.adminLogoutBtn) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                elements.adminLogoutBtn.addEventListener('click', () => {
                isAdminLoggedIn = false; 
                showInitialView();
                });
            }

            function populateAdminTenantList() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                elements.adminTenantList.innerHTML = '';
                if (masterAppData.users) {
                    const sortedUsers = Object.values(masterAppData.users)
                        .filter(user => user.loginName !== MASTER_USERNAME)
                        .sort((a,b) => (a.loginName || "").localeCompare(b.loginName || "", 'bn'));

                    if (sortedUsers.length === 0) {
                        const li = document.createElement('li');
                        li.textContent = '‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶ø‡¶§ ‡¶®‡ßá‡¶á‡•§';
                        li.className = 'note';
                        elements.adminTenantList.appendChild(li);
                        return;
                    }

                    sortedUsers.forEach(userContainer => {
                        const li = document.createElement('li');
                        li.className = 'tenant-list-item';
                        const nameSpan = document.createElement('span');
                        nameSpan.className = 'tenant-name-display';
                        nameSpan.innerHTML = `<i class="icon-user"></i> ${userContainer.loginName}`;
                        const actionsDiv = document.createElement('div');
                        actionsDiv.className = 'actions';
                        const deleteBtn = document.createElement('button');
                        deleteBtn.type = "button";
                        deleteBtn.className = 'btn btn-danger btn-small';
                        deleteBtn.innerHTML = `<i class="icon-delete"></i> ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®`;
                        deleteBtn.onclick = () => handleDeleteTenant(userContainer.tenantId, userContainer.loginName);
                        actionsDiv.appendChild(deleteBtn);
                        li.appendChild(nameSpan);
                        li.appendChild(actionsDiv);
                        elements.adminTenantList.appendChild(li);
                    });
                }
            }

            function handleDeleteTenant(tenantIdToDelete, tenantNameToDelete) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á, createLoginDropdown ‡¶ï‡¶≤ ‡¶π‡¶¨‡ßá ... */ 
                 showConfirmationModal(
                    '‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®',
                    `‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ "<b>${tenantNameToDelete}</b>"-‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶Ü‡¶®‡¶°‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§`,
                    () => {
                        if (masterAppData.users && masterAppData.users[tenantIdToDelete]) {
                            delete masterAppData.users[tenantIdToDelete];
                            localStorage.removeItem(`draft_${tenantIdToDelete}`); // Remove draft too
                            populateAdminTenantList();
                            createLoginDropdown(); 
                            alert(`‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ "${tenantNameToDelete}" ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`);
                        } else {
                            alert('‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
                        }
                    }
                );
            }
            
            if (elements.backToLoginBtn) elements.backToLoginBtn.addEventListener('click', showInitialView);

            function initializeNewTenantDataStructure(loginName) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                 return {
                    info: { name: loginName, mobile: '', meter: '', customerId: '', advance: '', nid: '', defaultRent: '', defaultGas: '' },
                    billingRecords: []
                };
            }

            function displayTenantInfo() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                const info = currentTenantData.info || initializeNewTenantDataStructure(currentTenantLoginName).info;
                elements.tenantNameInput.value = info.name || currentTenantLoginName;
                elements.tenantMobileInput.value = info.mobile || '';
                elements.tenantMeterInput.value = info.meter || '';
                elements.tenantCustomerIdInput.value = info.customerId || '';
                elements.tenantAdvanceInput.value = info.advance || '';
                elements.tenantNidInput.value = info.nid || '';
                elements.defaultRentInput.value = info.defaultRent || '';
                elements.defaultGasInput.value = info.defaultGas || '';
                [elements.tenantNameInput, elements.tenantMobileInput, elements.tenantMeterInput, elements.tenantCustomerIdInput, elements.tenantAdvanceInput, elements.tenantNidInput, elements.defaultRentInput, elements.defaultGasInput].forEach(field => {
                    if (field) setTimeout(() => autoExpandField(field), 120);
                });
            }

            function collectTenantInfoFromForm() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                if (!currentTenantData.info) currentTenantData.info = {};
                currentTenantData.info.name = elements.tenantNameInput.value || currentTenantLoginName;
                currentTenantData.info.mobile = elements.tenantMobileInput.value.trim();
                currentTenantData.info.meter = elements.tenantMeterInput.value.trim();
                currentTenantData.info.customerId = elements.tenantCustomerIdInput.value.trim();
                currentTenantData.info.advance = elements.tenantAdvanceInput.value.trim();
                currentTenantData.info.nid = elements.tenantNidInput.value.trim();
                currentTenantData.info.defaultRent = elements.defaultRentInput.value.trim();
                currentTenantData.info.defaultGas = elements.defaultGasInput.value.trim();
            }

            function renderBillingRecords() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á, addBillingCard ‡¶è index ‡¶™‡¶æ‡¶∏ ‡¶π‡¶¨‡ßá ... */ 
                if (!elements.billingRecordsContainer) return;
                elements.billingRecordsContainer.innerHTML = '';
                if (!currentTenantData.billingRecords) currentTenantData.billingRecords = [];
                
                currentTenantData.billingRecords.sort((a, b) => {
                    if ((a.year || 0) !== (b.year || 0)) return (a.year || 0) - (b.year || 0);
                    return (a.month || 0) - (b.month || 0);
                });

                if (currentTenantData.billingRecords.length > 0) {
                    currentTenantData.billingRecords.forEach((record, index) => addBillingCard(record, index)); // Pass index
                    if (elements.noRecordsMessage) elements.noRecordsMessage.style.display = 'none';
                } else {
                    if (elements.noRecordsMessage) elements.noRecordsMessage.style.display = 'block';
                }
                updateAllCalculationsAndUI();
                setupAutoExpandListeners(elements.billingRecordsContainer);
            }

            function populateMonthYearSelectors() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                elements.newBillYearSelect.innerHTML = '';
                elements.newBillMonthSelect.innerHTML = '';
                const currentSystemYear = new Date().getFullYear();
                for (let y = currentSystemYear - 3; y <= currentSystemYear + 5; y++) {
                    const option = document.createElement('option');
                    option.value = y; option.textContent = y;
                    elements.newBillYearSelect.appendChild(option);
                }
                monthNamesBn.forEach((name, index) => {
                    const option = document.createElement('option');
                    option.value = index + 1; option.textContent = name;
                    elements.newBillMonthSelect.appendChild(option);
                });
                let defaultYear = currentSystemYear;
                let defaultMonth = new Date().getMonth() + 1;
                if (currentTenantData.billingRecords && currentTenantData.billingRecords.length > 0) {
                    const sortedRecords = [...currentTenantData.billingRecords].sort((a,b) => (a.year*100 + a.month) - (b.year*100 + b.month));
                    const lastRecord = sortedRecords[sortedRecords.length - 1];
                    if (lastRecord && lastRecord.year && lastRecord.month) {
                        defaultMonth = parseInt(lastRecord.month) + 1; 
                        defaultYear = parseInt(lastRecord.year);
                        if (defaultMonth > 12) { defaultMonth = 1; defaultYear++; }
                    }
                }
                elements.newBillYearSelect.value = defaultYear;
                elements.newBillMonthSelect.value = defaultMonth;
                autoExpandField(elements.newBillYearSelect);
                autoExpandField(elements.newBillMonthSelect);
            }
            
            if (elements.addMonthBtn) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ 
                elements.addMonthBtn.addEventListener('click', () => {
                    populateMonthYearSelectors();
                    elements.addMonthError.style.display = 'none';
                    showModal(elements.addMonthModal);
                });
            }

            if (elements.confirmAddMonthBtn) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á, prevArrearsH ‡¶∏‡ßá‡¶ü ‡¶π‡¶¨‡ßá ... */ 
                elements.confirmAddMonthBtn.addEventListener('click', () => {
                    const year = parseInt(elements.newBillYearSelect.value);
                    const month = parseInt(elements.newBillMonthSelect.value);
                    elements.addMonthError.style.display = 'none';

                    if (isNaN(year) || isNaN(month)) { elements.addMonthError.textContent = '‡¶¨‡¶õ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡¶æ‡¶∏ ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'; elements.addMonthError.style.display = 'block'; return; }
                    if (year > (new Date().getFullYear() + 10)) { elements.addMonthError.textContent = '‡¶≠‡¶¨‡¶ø‡¶∑‡ßç‡¶Ø‡¶§‡ßá‡¶∞ ‡¶Ö‡¶®‡ßá‡¶ï ‡¶¶‡ßÅ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶õ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§'; elements.addMonthError.style.display = 'block'; return; }
                    const recordExists = currentTenantData.billingRecords.some(r => r.year === year && r.month === month);
                    if (recordExists) { elements.addMonthError.textContent = '‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§'; elements.addMonthError.style.display = 'block'; return; }
                    
                    let initialPrevArrears = 0;
                    if (currentTenantData.billingRecords && currentTenantData.billingRecords.length > 0) {
                        const lastSortedRecord = [...currentTenantData.billingRecords].sort((a,b) => (a.year*100 + a.month) - (b.year*100 + b.month)).pop();
                        initialPrevArrears = lastSortedRecord.newArrearsG || 0;
                    }

                    const newRecord = {
                        id: 'record_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        year: year, month: month,
                        rentA: parseFloat(elements.defaultRentInput.value) || 0,
                        gasB: parseFloat(elements.defaultGasInput.value) || 0,
                        currentC: 0, currentCPaidAmount: 0, currentCPaid: false,
                        vatD: 0, 
                        prevArrearsH: initialPrevArrears, 
                        depositF: 0, depositDate: null, comment: '',
                        confirmed: false, hidden: false
                    };
                    currentTenantData.billingRecords.push(newRecord);
                    renderBillingRecords(); // This will sort and display
                    const newCardElement = elements.billingRecordsContainer.querySelector(`.billing-record-card[data-id="${newRecord.id}"]`);
                    if (newCardElement) {
                        setupAutoExpandListeners(newCardElement);
                        newCardElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    hideModal(elements.addMonthModal);
                });
            }

            function addBillingCard(record, index) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á, prevArrearsH ‡¶è‡¶∞ readonly ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá ... */ 
                const cardDiv = document.createElement('div');
                cardDiv.className = 'billing-record-card';
                if (record.confirmed) cardDiv.classList.add('confirmed');
                cardDiv.dataset.id = record.id;
                const cardHeader = document.createElement('div'); cardHeader.className = 'card-header';
                const title = document.createElement('h4');
                const monthName = monthNamesBn[(record.month || 1) - 1] || `‡¶Æ‡¶æ‡¶∏ ${record.month}`;
                title.textContent = `‡¶¨‡¶ø‡¶≤: ${monthName}, ${record.year}`;
                const cardActionsDiv = document.createElement('div'); cardActionsDiv.className = 'card-actions';
                const toggleBtn = document.createElement('button'); toggleBtn.type = "button"; toggleBtn.className = 'btn btn-secondary btn-small toggle-content-btn'; toggleBtn.innerHTML = record.hidden ? '<i class="icon-view"></i> ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®' : '<i class="icon-hide"></i> ‡¶π‡¶æ‡¶á‡¶°'; toggleBtn.onclick = () => toggleCardContent(record.id); cardActionsDiv.appendChild(toggleBtn);
                const confirmBtn = document.createElement('button'); confirmBtn.type = "button"; confirmBtn.className = `btn btn-small ${record.confirmed ? 'btn-info' : 'btn-warning'} confirm-record-btn`; confirmBtn.innerHTML = record.confirmed ? '<i class="icon-edit"></i> ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®' : '<i class="icon-confirm"></i> ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ'; confirmBtn.onclick = () => toggleConfirmRecord(record.id); cardActionsDiv.appendChild(confirmBtn);
                const deleteBtn = document.createElement('button'); deleteBtn.type = "button"; deleteBtn.className = 'btn btn-danger btn-small delete-record-btn'; deleteBtn.innerHTML = '<i class="icon-delete"></i> ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®'; deleteBtn.onclick = () => handleDeleteRecord(record.id, `${monthName}, ${record.year}`); cardActionsDiv.appendChild(deleteBtn);
                cardHeader.appendChild(title); cardHeader.appendChild(cardActionsDiv); cardDiv.appendChild(cardHeader);
                const cardContent = document.createElement('div'); cardContent.className = 'card-content';
                if (record.hidden) cardContent.classList.add('hidden');

                function createFormGroup(label, inputType, className, value, placeholder, isReadonly = false, metaInfo = null, specialClass = '') {
                    const fg = document.createElement('div'); fg.className = `form-group ${specialClass}`;
                    const lbl = document.createElement('label'); lbl.textContent = label + ':';
                    const inputWrapper = document.createElement('div'); inputWrapper.className = metaInfo ? 'input-with-meta' : '';
                    const input = document.createElement(inputType === 'textarea' ? 'textarea' : 'input');
                    if (inputType !== 'textarea') input.type = inputType;
                    input.className = `${className} auto-expand`; input.value = value;
                    if (placeholder) input.placeholder = placeholder;
                    if (inputType === 'number') input.step = "0.01";
                    input.readOnly = isReadonly;
                    if (isReadonly && !input.classList.contains('prevArrearsH')) { 
                        input.classList.add('readonly-calc-field');
                    }
                    if (record.confirmed) {
                        if (!(input.classList.contains('prevArrearsH') && index === 0 && !isReadonly)) { 
                             input.classList.add('confirmed-input');
                        }
                    }
                    inputWrapper.appendChild(input); if (metaInfo) { inputWrapper.appendChild(metaInfo); }
                    fg.appendChild(lbl); fg.appendChild(inputWrapper); return fg;
                }
                
                cardContent.appendChild(createFormGroup('‡¶≠‡¶æ‡ßú‡¶æ (A)', 'number', 'rentA', record.rentA || 0, '0.00', record.confirmed));
                cardContent.appendChild(createFormGroup('‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏ (B)', 'number', 'gasB', record.gasB || 0, '0.00', record.confirmed));
                cardContent.appendChild(createFormGroup('‡¶ï‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶≤ (C)', 'number', 'currentC', record.currentC || 0, '0.00', record.confirmed));
                const currentPaidAmountGroup = document.createElement('div'); 
                currentPaidAmountGroup.className = `form-group currentC-paid-amount-group ${record.currentCPaid ? 'paid' : 'not-paid'}`;
                const currentPaidLabel = document.createElement('label'); currentPaidLabel.textContent = '‡¶ï‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶≤ ‡¶ú‡¶Æ‡¶æ (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá):';
                const currentPaidInputWrapper = document.createElement('div'); currentPaidInputWrapper.className = 'input-with-meta';
                const currentPaidInput = document.createElement('input'); currentPaidInput.type = 'number'; currentPaidInput.step = "0.01"; currentPaidInput.className = 'currentCPaidAmount auto-expand'; currentPaidInput.value = record.currentCPaidAmount || 0; currentPaidInput.placeholder = '0.00'; currentPaidInput.readOnly = record.confirmed || record.currentCPaid;
                const currentPaidBtn = document.createElement('button'); currentPaidBtn.type = "button"; currentPaidBtn.className = `btn btn-small ${record.currentCPaid ? 'btn-success' : 'btn-danger'} currentC-paid-btn`; currentPaidBtn.textContent = record.currentCPaid ? '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§' : '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®'; currentPaidBtn.disabled = record.confirmed;
                currentPaidBtn.onclick = () => { 
                    if (record.confirmed && !record.currentCPaid && !record.currentCPaidAmount > 0) return; 
                    record.currentCPaid = !record.currentCPaid;
                    if (record.currentCPaid && (currentPaidInput.value === "0" || !currentPaidInput.value)) { currentPaidInput.value = record.currentC || 0; }
                    record.currentCPaidAmount = parseFloat(currentPaidInput.value) || 0;
                    updateSingleCardUI(record.id); updateAllCalculationsAndUI();
                };
                currentPaidInputWrapper.appendChild(currentPaidInput); currentPaidInputWrapper.appendChild(currentPaidBtn);
                currentPaidAmountGroup.appendChild(currentPaidLabel); currentPaidAmountGroup.appendChild(currentPaidInputWrapper);
                cardContent.appendChild(currentPaidAmountGroup);

                cardContent.appendChild(createFormGroup('‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (D)', 'number', 'vatD', record.vatD || 0, '0.00', record.confirmed));
                cardContent.appendChild(createFormGroup('‡¶∏‡¶æ‡¶¨-‡¶ü‡ßã‡¶ü‡¶æ‡¶≤ (X = A+B+C+D)', 'number', 'subTotalX', 0, '', true));
                
                const isPrevArrearsHFieldReadOnly = index > 0 || record.confirmed;
                cardContent.appendChild(createFormGroup('‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ (H)', 'number', 'prevArrearsH', record.prevArrearsH || 0, '0.00', isPrevArrearsHFieldReadOnly));

                const totalAmountT_FG = createFormGroup('‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶¶‡ßá‡ßü (T = X+H)', 'number', 'totalAmountT-field', 0, '', true); cardContent.appendChild(totalAmountT_FG);
                const depositDateSpan = document.createElement('span'); depositDateSpan.className = 'input-meta-info deposit-date-display'; depositDateSpan.textContent = record.depositDate ? `(${new Date(record.depositDate).toLocaleDateString('bn-BD', { day: '2-digit', month: '2-digit', year: 'numeric' })})` : '(‡¶ú‡¶Æ‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ)';
                const depositF_FG = createFormGroup('‡¶Æ‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ (F)', 'number', 'depositF', record.depositF || 0, '0.00', record.confirmed, depositDateSpan, 'depositF-group');
                if (record.depositF > 0) depositF_FG.classList.add('has-deposit'); else depositF_FG.classList.remove('has-deposit');
                cardContent.appendChild(depositF_FG);
                cardContent.appendChild(createFormGroup('‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ï‡ßá‡ßü‡¶æ/‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ (G = T-F)', 'number', 'newArrearsG', 0, '', true));
                cardContent.appendChild(createFormGroup('‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø', 'textarea', 'comment', record.comment || '', '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá)', record.confirmed));
                const statusDiv = document.createElement('div'); statusDiv.className = 'status-display'; cardContent.appendChild(statusDiv);
                cardDiv.appendChild(cardContent); elements.billingRecordsContainer.appendChild(cardDiv);
                cardDiv.querySelectorAll('input:not([readonly]), textarea:not([readonly])').forEach(input => {
                    input.addEventListener('input', (event) => handleCardInputChange(event, record.id, index));
                    input.addEventListener('change', (event) => handleCardInputChange(event, record.id, index));
                });
                setupAutoExpandListeners(cardDiv);
            }
            
            function updateSingleCardUI(recordId) { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á, prevArrearsH ‡¶è‡¶∞ readonly ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá ... */ 
                const record = currentTenantData.billingRecords.find(r => r.id === recordId);
                if (!record) return;
                const cardElement = elements.billingRecordsContainer.querySelector(`.billing-record-card[data-id="${recordId}"]`);
                if (!cardElement) return;
                const recordIndex = currentTenantData.billingRecords.findIndex(r => r.id === recordId);

                const currentPaidGroup = cardElement.querySelector('.currentC-paid-amount-group');
                if (currentPaidGroup) { 
                    currentPaidGroup.classList.toggle('paid', !!record.currentCPaid); 
                    currentPaidGroup.classList.toggle('not-paid', !record.currentCPaid);
                    const paidBtn = currentPaidGroup.querySelector('.currentC-paid-btn');
                    if(paidBtn){
                         paidBtn.textContent = record.currentCPaid ? '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§' : '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®';
                         paidBtn.className = `btn btn-small ${record.currentCPaid ? 'btn-success' : 'btn-danger'} currentC-paid-btn`;
                         paidBtn.disabled = record.confirmed;
                    }
                    const paidInput = cardElement.querySelector('.currentCPaidAmount');
                    if (paidInput) {
                        paidInput.value = record.currentCPaidAmount || 0;
                        paidInput.readOnly = record.confirmed || record.currentCPaid;
                    }
                } 

                const depositFG = cardElement.querySelector('.depositF-group');
                const dateDisplay = cardElement.querySelector('.deposit-date-display');
                if (depositFG) depositFG.classList.toggle('has-deposit', record.depositF > 0);
                if (dateDisplay) dateDisplay.textContent = record.depositDate ? `(${new Date(record.depositDate).toLocaleDateString('bn-BD', { day: '2-digit', month: '2-digit', year: 'numeric' })})` : '(‡¶ú‡¶Æ‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ)';
                
                cardElement.querySelectorAll('input:not(.readonly-calc-field):not(.currentCPaidAmount), textarea').forEach(inputEl => {
                    const isPrevArrearsField = inputEl.classList.contains('prevArrearsH');
                    let makeReadOnly = record.confirmed;
                    if (isPrevArrearsField) {
                        makeReadOnly = recordIndex > 0 || record.confirmed; 
                    }
                    inputEl.readOnly = makeReadOnly;
                    if (makeReadOnly) inputEl.classList.add('confirmed-input');
                    else inputEl.classList.remove('confirmed-input');
                });
                 const prevArrearsHField = cardElement.querySelector('.prevArrearsH');
                 if (prevArrearsHField) {
                    prevArrearsHField.readOnly = recordIndex > 0 || record.confirmed;
                    if(prevArrearsHField.readOnly) {
                        if (recordIndex > 0) prevArrearsHField.classList.add('readonly-calc-field'); 
                        else prevArrearsHField.classList.add('confirmed-input'); 
                        prevArrearsHField.classList.remove(recordIndex > 0 ? 'confirmed-input': 'readonly-calc-field');
                    } else {
                        prevArrearsHField.classList.remove('readonly-calc-field', 'confirmed-input');
                    }
                 }

                const confirmBtn = cardElement.querySelector('.confirm-record-btn');
                if (confirmBtn) { 
                    confirmBtn.innerHTML = record.confirmed ? '<i class="icon-edit"></i> ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®' : '<i class="icon-confirm"></i> ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ';
                    confirmBtn.className = `btn btn-small ${record.confirmed ? 'btn-info' : 'btn-warning'} confirm-record-btn`;
                } 
                cardElement.classList.toggle('confirmed', record.confirmed);
            }

            function toggleCardContent(recordId) { 
                const record = currentTenantData.billingRecords.find(r => r.id === recordId);
                if (!record) return;
                record.hidden = !record.hidden;
                const cardElement = elements.billingRecordsContainer.querySelector(`.billing-record-card[data-id="${recordId}"]`);
                if (cardElement) {
                    const content = cardElement.querySelector('.card-content');
                    const toggleBtn = cardElement.querySelector('.toggle-content-btn');
                    if (content) content.classList.toggle('hidden', record.hidden);
                    if (toggleBtn) toggleBtn.innerHTML = record.hidden ? '<i class="icon-view"></i> ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®' : '<i class="icon-hide"></i> ‡¶π‡¶æ‡¶á‡¶°';
                }
            }

            function toggleConfirmRecord(recordId) { 
                const record = currentTenantData.billingRecords.find(r => r.id === recordId);
                if (!record) return;
                const recordIndex = currentTenantData.billingRecords.findIndex(r => r.id === recordId);
                
                if (!record.confirmed) { 
                    const cardElement = elements.billingRecordsContainer.querySelector(`.billing-record-card[data-id="${recordId}"]`);
                    if (cardElement) {
                        record.rentA = parseFloat(cardElement.querySelector('.rentA').value) || 0;
                        record.gasB = parseFloat(cardElement.querySelector('.gasB').value) || 0;
                        record.currentC = parseFloat(cardElement.querySelector('.currentC').value) || 0;
                        record.vatD = parseFloat(cardElement.querySelector('.vatD').value) || 0;
                        if (recordIndex === 0) { // prevArrearsH only editable for first record before confirmation
                           record.prevArrearsH = parseFloat(cardElement.querySelector('.prevArrearsH').value) || 0;
                        }
                        record.depositF = parseFloat(cardElement.querySelector('.depositF').value) || 0;
                        record.comment = cardElement.querySelector('.comment').value.trim();
                        if (record.depositF > 0 && !record.depositDate) record.depositDate = new Date().toISOString();
                    }
                }
                record.confirmed = !record.confirmed;
                updateSingleCardUI(recordId); 
                updateAllCalculationsAndUI(); 
            }

            function handleCardInputChange(event, recordId, index) { 
                const record = currentTenantData.billingRecords.find(r => r.id === recordId);
                const isPrevArrearsFirstRecordNotConfirmed = event.target.classList.contains('prevArrearsH') && index === 0 && !record.confirmed;

                if (!record || (record.confirmed && !isPrevArrearsFirstRecordNotConfirmed) ) { // If record confirmed, only allow prevArrearsH for first UNCONFIRMED record
                     return;
                }

                const target = event.target;
                const fieldClass = target.classList[0];
                let value = target.type === 'number' ? parseFloat(target.value) : target.value;
                if (target.type === 'number' && isNaN(value)) value = 0;

                switch (fieldClass) {
                    case 'rentA': record.rentA = value; break;
                    case 'gasB': record.gasB = value; break;
                    case 'currentC': record.currentC = value; break;
                    case 'currentCPaidAmount': record.currentCPaidAmount = value; if (value > 0 && !record.currentCPaid) record.currentCPaid = true; break;
                    case 'vatD': record.vatD = value; break;
                    case 'prevArrearsH': if (index === 0 && !record.confirmed) record.prevArrearsH = value; break; 
                    case 'depositF': record.depositF = value; if (record.depositF > 0 && !record.depositDate) record.depositDate = new Date().toISOString(); break;
                    case 'comment': record.comment = value.trim(); break;
                }
                updateAllCalculationsAndUI();
                 // Update the specific field's UI in case of auto-calculation overwriting focused input
                if (target.type === 'number') { setTimeout(() => autoExpandField(target),50); }
                else { setTimeout(() => autoExpandField(target),50); }
            }

            function handleDeleteRecord(recordId, recordIdentifier) { 
                showConfirmationModal('‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®', `‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø "${recordIdentifier}" ‡¶¨‡¶ø‡¶≤‡¶ü‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`, () => {
                    currentTenantData.billingRecords = currentTenantData.billingRecords.filter(r => r.id !== recordId);
                    renderBillingRecords();
                });
            }
            
            function updateAllCalculationsAndUI() { 
                if (!currentTenantData.billingRecords || currentTenantData.billingRecords.length === 0) {
                    if (elements.noRecordsMessage) elements.noRecordsMessage.style.display = 'block';
                    return;
                }
                if (elements.noRecordsMessage) elements.noRecordsMessage.style.display = 'none';

                currentTenantData.billingRecords.sort((a, b) => {
                    if ((a.year || 0) !== (b.year || 0)) return (a.year || 0) - (b.year || 0);
                    return (a.month || 0) - (b.month || 0);
                });

                currentTenantData.billingRecords.forEach((record, index) => {
                    if (index > 0) { 
                        record.prevArrearsH = currentTenantData.billingRecords[index - 1].newArrearsG || 0;
                    } 
                    else if (typeof record.prevArrearsH !== 'number' || isNaN(record.prevArrearsH)) {
                        record.prevArrearsH = 0;
                    }

                    const rentA = record.rentA || 0;
                    const gasB = record.gasB || 0;
                    const currentC = record.currentC || 0;
                    const vatD = record.vatD || 0;
                    const depositF = record.depositF || 0;
                    const prevArrearsHVal = record.prevArrearsH || 0; 

                    const subTotalX = rentA + gasB + currentC + vatD;
                    const totalAmountT = subTotalX + prevArrearsHVal;
                    const newArrearsG = totalAmountT - depositF;

                    record.subTotalX = subTotalX;
                    record.totalAmountT = totalAmountT;
                    record.newArrearsG = newArrearsG;

                    const cardElement = elements.billingRecordsContainer.querySelector(`.billing-record-card[data-id="${record.id}"]`);
                    if (cardElement) {
                        const updateIfNotFocused = (el, val, isNumber = true) => {
                            if (el && !el.matches(':focus')) {
                                el.value = isNumber ? (val || 0).toFixed(2) : (val || '');
                            } else if (el && el.matches(':focus') && isNumber && el.value !== (val || 0).toFixed(2) && el.value !== String(val)) {
                                // User is typing, don't overwrite
                            }
                        };

                        updateIfNotFocused(cardElement.querySelector('.rentA'), rentA);
                        updateIfNotFocused(cardElement.querySelector('.gasB'), gasB);
                        updateIfNotFocused(cardElement.querySelector('.currentC'), currentC);
                        updateIfNotFocused(cardElement.querySelector('.vatD'), vatD);
                        updateIfNotFocused(cardElement.querySelector('.depositF'), depositF);
                        updateIfNotFocused(cardElement.querySelector('.comment'), record.comment, false);
                        updateIfNotFocused(cardElement.querySelector('.currentCPaidAmount'), record.currentCPaidAmount);

                        const prevArrearsHEl = cardElement.querySelector('.prevArrearsH');
                        if (prevArrearsHEl) {
                            prevArrearsHEl.readOnly = index > 0 || record.confirmed;
                            if (index > 0 || record.confirmed) { 
                                prevArrearsHEl.value = prevArrearsHVal.toFixed(2);
                                if(index > 0) prevArrearsHEl.classList.add('readonly-calc-field'); else prevArrearsHEl.classList.add('confirmed-input');
                                prevArrearsHEl.classList.remove(index > 0 ? 'confirmed-input': 'readonly-calc-field');
                            } else { 
                                if(!prevArrearsHEl.matches(':focus')) prevArrearsHEl.value = prevArrearsHVal.toFixed(2);
                                prevArrearsHEl.classList.remove('readonly-calc-field', 'confirmed-input');
                            }
                        }

                        const subTotalXEl = cardElement.querySelector('.subTotalX'); if (subTotalXEl) subTotalXEl.value = subTotalX.toFixed(2);
                        const totalAmountTEl = cardElement.querySelector('.totalAmountT-field'); if (totalAmountTEl) totalAmountTEl.value = totalAmountT.toFixed(2);
                        const newArrearsGEl = cardElement.querySelector('.newArrearsG'); if (newArrearsGEl) newArrearsGEl.value = newArrearsG.toFixed(2);
                        
                        const depositFG = cardElement.querySelector('.depositF-group'); if(depositFG) depositFG.classList.toggle('has-deposit', record.depositF > 0);
                        const dateDisplay = cardElement.querySelector('.deposit-date-display'); if(dateDisplay) dateDisplay.textContent = record.depositDate ? `(${new Date(record.depositDate).toLocaleDateString('bn-BD', { day: '2-digit', month: '2-digit', year: 'numeric' })})` : '(‡¶ú‡¶Æ‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ)';
                        const currentPaidGroup = cardElement.querySelector('.currentC-paid-amount-group');  
                        if (currentPaidGroup) {
                            currentPaidGroup.classList.toggle('paid', !!record.currentCPaid); currentPaidGroup.classList.toggle('not-paid', !record.currentCPaid);
                            const paidBtn = currentPaidGroup.querySelector('.currentC-paid-btn'); if (paidBtn) { paidBtn.textContent = record.currentCPaid ? '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§' : '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®'; paidBtn.className = `btn btn-small ${record.currentCPaid ? 'btn-success' : 'btn-danger'} currentC-paid-btn`; paidBtn.disabled = record.confirmed; }
                            const paidInput = cardElement.querySelector('.currentCPaidAmount'); if (paidInput) { updateIfNotFocused(paidInput, record.currentCPaidAmount); paidInput.readOnly = record.confirmed || record.currentCPaid; }
                        }
                        const monthName = monthNamesBn[(record.month || 1) - 1] || `‡¶Æ‡¶æ‡¶∏ ${record.month}`;
                        const titleEl = cardElement.querySelector('.card-header h4'); if (titleEl) titleEl.textContent = `‡¶¨‡¶ø‡¶≤: ${monthName}, ${record.year}`;
                        const statusDiv = cardElement.querySelector('.status-display');  
                        if (statusDiv) {
                            statusDiv.className = 'status-display';
                            if (totalAmountT === 0 && depositF === 0 && prevArrearsHVal === 0 && subTotalX === 0 && !record.confirmed) { statusDiv.textContent = '‡¶Ö‡¶Æ‡ßÄ‡¶Æ‡¶æ‡¶Ç‡¶∏‡¶ø‡¶§'; statusDiv.classList.add('status-pending'); }
                            else if (Math.abs(newArrearsG) < 0.01 && (record.depositF >= totalAmountT || totalAmountT === 0) && (totalAmountT > 0 || depositF > 0 || record.confirmed) ) { statusDiv.textContent = '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§'; statusDiv.classList.add('status-paid'); }
                            else if (newArrearsG > 0.009) { statusDiv.textContent = `‡¶¨‡¶ï‡ßá‡ßü‡¶æ: ${newArrearsG.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ`; statusDiv.classList.add('status-due'); }
                            else if (newArrearsG < -0.009) { statusDiv.textContent = `‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ: ${Math.abs(newArrearsG).toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ`; statusDiv.classList.add('status-advance'); }
                            else { statusDiv.textContent = record.confirmed ? '‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®' : '‡¶Ö‡¶Æ‡ßÄ‡¶Æ‡¶æ‡¶Ç‡¶∏‡¶ø‡¶§'; statusDiv.classList.add(record.confirmed ? 'status-paid' : 'status-pending'); }
                        }
                        cardElement.querySelectorAll('.auto-expand').forEach(field => setTimeout(() => autoExpandField(field), 70));
                    }
                });
            }

            // Draft Saving Logic
            if(elements.saveDraftBtn) {
                elements.saveDraftBtn.addEventListener('click', () => {
                    if (!currentTenantId) {
                        alert("‡¶ñ‡¶∏‡ßú‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶ó‡ßá ‡¶è‡¶ï‡¶ú‡¶® ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ‡¶ï‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§");
                        return;
                    }
                    collectTenantInfoFromForm(); 
                    currentTenantData.billingRecords.forEach((record, index) => {
                        const cardElement = elements.billingRecordsContainer.querySelector(`.billing-record-card[data-id="${record.id}"]`);
                        if (cardElement && !record.confirmed) { 
                            record.rentA = parseFloat(cardElement.querySelector('.rentA').value) || 0;
                            record.gasB = parseFloat(cardElement.querySelector('.gasB').value) || 0;
                            record.currentC = parseFloat(cardElement.querySelector('.currentC').value) || 0;
                            record.vatD = parseFloat(cardElement.querySelector('.vatD').value) || 0;
                            if (index === 0) { 
                                record.prevArrearsH = parseFloat(cardElement.querySelector('.prevArrearsH').value) || 0;
                            }
                            record.depositF = parseFloat(cardElement.querySelector('.depositF').value) || 0;
                            record.comment = cardElement.querySelector('.comment').value.trim();
                        }
                    });

                    const draftData = {
                        tenantId: currentTenantId,
                        loginName: currentTenantLoginName,
                        data: JSON.parse(JSON.stringify(currentTenantData)) 
                    };
                    localStorage.setItem(`draft_${currentTenantId}`, JSON.stringify(draftData));
                    alert(`"${currentTenantLoginName}" ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ñ‡¶∏‡ßú‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`);
                });
            }

            function checkAndPromptForDraft() {
                let foundDraftKey = null;
                for (let i = 0; i < localStorage.length; i++) {
                    if (localStorage.key(i).startsWith('draft_')) {
                        foundDraftKey = localStorage.key(i);
                        break;
                    }
                }

                if (foundDraftKey) {
                    try {
                        const draft = JSON.parse(localStorage.getItem(foundDraftKey));
                        if (draft && draft.loginName) {
                            elements.draftUserNameSpan.textContent = draft.loginName;
                            elements.loadDraftPrompt.style.display = 'block';
                            elements.confirmLoadDraftBtn.onclick = () => {
                                currentTenantId = draft.tenantId;
                                currentTenantLoginName = draft.loginName;
                                currentTenantData = draft.data; 
                                switchToAppView(true); 
                                elements.loadDraftPrompt.style.display = 'none';
                            };
                            elements.cancelLoadDraftBtn.onclick = () => {
                                localStorage.removeItem(foundDraftKey); 
                                elements.loadDraftPrompt.style.display = 'none';
                                alert("‡¶ñ‡¶∏‡ßú‡¶æ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
                            };
                        } else { localStorage.removeItem(foundDraftKey); } 
                    } catch (e) {
                        console.error("Error parsing draft:", e);
                        localStorage.removeItem(foundDraftKey); 
                    }
                }
            }
            
            function clearDraftData(tenantId) {
                localStorage.removeItem(`draft_${tenantId}`);
            }

            // Cloud Save (JSON Export)
            if(elements.saveToCloudBtn) {
                elements.saveToCloudBtn.addEventListener('click', () => {
                    if (!currentTenantId) {
                        alert("‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶ï‡¶ú‡¶® ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ‡¶ï‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                        return;
                    }
                    if (!loggedInUserEmail) {
                        alert("‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶°‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤/‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶° ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç' ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                        showUserProfileView();
                        return;
                    }

                    collectTenantInfoFromForm(); 
                    currentTenantData.billingRecords.forEach((record, index) => {
                        const cardElement = elements.billingRecordsContainer.querySelector(`.billing-record-card[data-id="${record.id}"]`);
                        if (cardElement && !record.confirmed) { 
                             record.rentA = parseFloat(cardElement.querySelector('.rentA').value) || 0;
                             record.gasB = parseFloat(cardElement.querySelector('.gasB').value) || 0;
                             record.currentC = parseFloat(cardElement.querySelector('.currentC').value) || 0;
                             record.vatD = parseFloat(cardElement.querySelector('.vatD').value) || 0;
                             record.depositF = parseFloat(cardElement.querySelector('.depositF').value) || 0;
                             record.comment = cardElement.querySelector('.comment').value.trim();
                        }
                        if (index === 0 && cardElement && !cardElement.querySelector('.prevArrearsH').readOnly && !record.confirmed) { 
                           record.prevArrearsH = parseFloat(cardElement.querySelector('.prevArrearsH').value) || 0;
                        }
                    });


                    const dataToExport = {
                        profileEmail: loggedInUserEmail, 
                        tenantId: currentTenantId,
                        loginName: currentTenantLoginName,
                        data: currentTenantData 
                    };
                    
                    if (!masterAppData.user_profiles) masterAppData.user_profiles = {};
                    masterAppData.user_profiles[loggedInUserEmail] = JSON.parse(JSON.stringify(dataToExport));

                    elements.exportedJsonDataTextarea.value = JSON.stringify(dataToExport, null, 2);
                    showModal(elements.dataExportModal);
                    autoExpandField(elements.exportedJsonDataTextarea);
                });
            }

            if(elements.copyJsonBtn) {
                elements.copyJsonBtn.addEventListener('click', () => {
                    elements.exportedJsonDataTextarea.select();
                    document.execCommand('copy');
                    alert("JSON ‡¶°‡ßá‡¶ü‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                });
            }


            const rainbowColors = ['#FFADAD', '#FFD6A5', '#FDFFB6', '#CAFFBF', '#9BF6FF', '#A0C4FF', '#BDB2FF', '#FFC6FF'];
            let rainbowColorIndex = 0;
            function startRainbowEffect() { 
                stopRainbowEffect();
                if (elements.appContent.style.display !== 'none' && elements.welcomeMessage) {
                    rainbowIntervalId = setInterval(() => {
                        elements.welcomeMessage.style.backgroundImage = `linear-gradient(to right, ${rainbowColors[rainbowColorIndex % rainbowColors.length]}, ${rainbowColors[(rainbowColorIndex + 1) % rainbowColors.length]})`;
                        rainbowColorIndex++;
                    }, 1000);
                }
             }
            function stopRainbowEffect() { 
                if (rainbowIntervalId) {
                    clearInterval(rainbowIntervalId);
                    rainbowIntervalId = null;
                }
                if (elements.welcomeMessage) { // Reset to default gradient
                     elements.welcomeMessage.style.backgroundImage = `linear-gradient(to right, var(--primary-color), var(--primary-color-dark))`;
                }
            }

            function saveDataAndDownloadHtml() { 
                if (!isAdminLoggedIn && !currentTenantId && !loggedInUserEmail) {
                    alert('‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á ‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á‡•§ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); return;
                }

                if (!isAdminLoggedIn && currentTenantId) {
                    collectTenantInfoFromForm();
                    currentTenantData.billingRecords.forEach((record, index) => { 
                        const cardElement = elements.billingRecordsContainer.querySelector(`.billing-record-card[data-id="${record.id}"]`);
                        if (cardElement && !record.confirmed) { 
                             record.rentA = parseFloat(cardElement.querySelector('.rentA').value) || 0;
                             record.gasB = parseFloat(cardElement.querySelector('.gasB').value) || 0;
                             record.currentC = parseFloat(cardElement.querySelector('.currentC').value) || 0;
                             record.vatD = parseFloat(cardElement.querySelector('.vatD').value) || 0;
                             record.depositF = parseFloat(cardElement.querySelector('.depositF').value) || 0;
                             record.comment = cardElement.querySelector('.comment').value.trim();
                        }
                        if (index === 0 && cardElement && !cardElement.querySelector('.prevArrearsH').readOnly && !record.confirmed) { 
                           record.prevArrearsH = parseFloat(cardElement.querySelector('.prevArrearsH').value) || 0;
                        }
                    });
                    masterAppData.users[currentTenantId] = {
                        tenantId: currentTenantId,
                        loginName: currentTenantLoginName,
                        data: JSON.parse(JSON.stringify(currentTenantData))
                    };
                }
                if (loggedInUserEmail && masterAppData.user_profiles && masterAppData.user_profiles[loggedInUserEmail]) {
                    // Data already in masterAppData.user_profiles
                } else if (loggedInUserEmail && currentTenantId && currentTenantData) { // User has profile, but no data in user_profiles yet
                     masterAppData.user_profiles[loggedInUserEmail] = {
                        profileEmail: loggedInUserEmail,
                        tenantId: currentTenantId, 
                        loginName: currentTenantLoginName,
                        data: JSON.parse(JSON.stringify(currentTenantData))
                    };
                }
                
                const dataToEmbedInHtml = JSON.parse(JSON.stringify(masterAppData)); 
                const jsonDataString = JSON.stringify(dataToEmbedInHtml, null, 2); 
                let currentHtml = document.documentElement.outerHTML;
                const placeholderRegex = /<script id="app-data-store" type="application\/json">.*?<\/script>/s;
                const newScriptTag = `<script id="app-data-store" type="application\/json">${jsonDataString}<\/script>`;
                if (currentHtml.match(placeholderRegex)) { currentHtml = currentHtml.replace(placeholderRegex, newScriptTag); } 
                else { currentHtml = currentHtml.replace(/<\/body>/i, `${newScriptTag}\n</body>`); }
                currentHtml = currentHtml.replace(/\s*<!--\s*CodePen Hint: Insert your Global JS here\s*-->\s*/i, ''); // Remove codepen hints
                currentHtml = currentHtml.replace(/<script src="https:\/\/cpwebassets.codepen.io\/assets\/editor\/iframe\/iframeRefreshCSS[^>]*><\/script>\s*/i, '');
                currentHtml = currentHtml.replace(/<script src="https:\/\/cpwebassets.codepen.io\/assets\/editor\/iframe\/iframeRuntimeErrors[^>]*><\/script>\s*/i, '');
                currentHtml = currentHtml.replace(/<script src="https:\/\/cpwebassets.codepen.io\/assets\/editor\/iframe\/iframeConsoleRunner[^>]*><\/script>\s*/i, '');
                currentHtml = currentHtml.replace(/<script src="https:\/\/cpwebassets.codepen.io\/assets\/common\/stopExecutionOnTimeout[^>]*><\/script>\s*/i, '');
                
                const suggestedFileName = `BariVaraApp_Data_${new Date().toISOString().slice(0, 10).replace(/-/g, '')}.html`;
                const dataUri = 'data:text/html;charset=utf-8,' + encodeURIComponent(currentHtml);
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri); linkElement.setAttribute('download', suggestedFileName);
                document.body.appendChild(linkElement); linkElement.click(); document.body.removeChild(linkElement);
                alert(`‡¶´‡¶æ‡¶á‡¶≤ "${suggestedFileName}" ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`);
            }

            if (elements.downloadUpdatedHtmlBtn) elements.downloadUpdatedHtmlBtn.addEventListener('click', saveDataAndDownloadHtml);
            if (elements.adminDownloadAllDataHtmlBtn) elements.adminDownloadAllDataHtmlBtn.addEventListener('click', saveDataAndDownloadHtml);

            loadInitialData();
            showInitialView(); 
            setupAutoExpandListeners(document.body); 

        });
    </script>



  
  




  
  


</body></html>